<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarlyBird Admin - Savior</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles/styles.css">
    <link rel="stylesheet" href="../styles/subscription-integration.css">
    <style>
        /* Enhanced Calendar Styles */
        .calendar-layout {
            display: flex;
            gap: 20px;
            min-height: 600px;
        }

        .calendar-container {
            flex: 1;
            max-width: 500px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .calendar-header {
            background: linear-gradient(135deg, #FF6B35 0%, #E85A2A 100%);
            color: white;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .calendar-month-title {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .calendar-nav {
            display: flex;
            gap: 8px;
        }

        .calendar-nav button {
            padding: 6px 12px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .calendar-nav button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
        }

        #calendarGrid {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background: white;
        }

        #dateDetailView {
            flex: 1;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
            overflow-y: auto;
            max-height: 600px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .date-detail-view h3 {
            margin-top: 0;
            margin-bottom: 16px;
            color: #FF6B35;
            font-size: 18px;
        }

        .date-detail-item {
            padding: 12px;
            background: #f9fafb;
            border-radius: 6px;
            margin-bottom: 12px;
            border-left: 3px solid #FF6B35;
        }

        .date-detail-item strong {
            display: block;
            margin-bottom: 4px;
            color: #333;
        }

        .date-detail-item span {
            color: #666;
            font-size: 13px;
        }

        /* Calendar grid improvements */
        .calendar-day {
            min-height: 70px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #e5e7eb;
            position: relative;
        }

        .calendar-day:hover {
            border-color: #FF6B35;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.15);
            transform: translateY(-2px);
        }

        .calendar-day.selected {
            background: #fffef0;
            border-color: #FF6B35;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.15);
        }

        @media (max-width: 1200px) {
            .calendar-layout {
                flex-direction: column;
            }

            .calendar-container,
            #dateDetailView {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="app-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon">üåÖ</div>
                    <div class="logo-text">
                        <h1>EarlyBird</h1>
                        <p>Admin Portal</p>
                    </div>
                </div>
            </div>

            <nav class="nav-menu">
                <div class="nav-item active" data-page="calendar" onclick="showPage('calendar')">
                    <span class="nav-icon">üìÖ</span>
                    <span>Calendar</span>
                </div>
                <div class="nav-item" data-page="dashboard" onclick="showPage('dashboard')">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" data-page="customers" onclick="showPage('customers')">
                    <span class="nav-icon">üë•</span>
                    <span>Customers</span>
                </div>
                <div class="nav-item" data-page="orders" onclick="showPage('orders'); adminPortalUI.loadSubscriptions()">
                    <span class="nav-icon">üîÑ</span>
                    <span>Subscriptions & Orders</span>
                </div>
                <div class="nav-item" data-page="billing" onclick="showPage('billing'); adminPortalUI.loadBillingView()">
                    <span class="nav-icon">üí≥</span>
                    <span>Billing & Invoices</span>
                </div>
                <div class="nav-item" data-page="staff" onclick="showPage('staff')" style="display: none;">
                    <span class="nav-icon">üëî</span>
                    <span>Staff</span>
                </div>
                <div class="nav-item" data-page="suppliers" onclick="showPage('suppliers')">
                    <span class="nav-icon">üè≠</span>
                    <span>Suppliers</span>
                </div>
                <div class="nav-item" data-page="wallets" onclick="showPage('wallets')">
                    <span class="nav-icon">üí∞</span>
                    <span>Wallets</span>
                </div>
                <div class="nav-item" data-page="monthlyBilling" onclick="showPage('monthlyBilling'); monthlyBillingUI.init()">
                    <span class="nav-icon">üìä</span>
                    <span>Monthly Billing</span>
                </div>
                <div class="nav-item" data-page="users" onclick="showPage('users'); userManagementUI.loadUsers()">
                    <span class="nav-icon">üë•</span>
                    <span>User Management</span>
                </div>
                <div class="nav-item" data-page="areas" onclick="showPage('areas'); areaManagementUI.loadAreas()">
                    <span class="nav-icon">üó∫Ô∏è</span>
                    <span>Area Management</span>
                </div>
                <div class="nav-item" data-page="dataImport" onclick="showPage('dataImport')">
                    <span class="nav-icon">üì•</span>
                    <span>Data Import</span>
                </div>
                <div style="margin: 12px 20px; height: 1px; background: var(--border);"></div>
                <div style="padding: 12px 20px; font-size: 11px; font-weight: 700; text-transform: uppercase; color: var(--text-tertiary);">Phase 3 Operations</div>
                <div class="nav-item" data-page="supplier" onclick="showPage('supplier'); phase3UI.initSupplierUI()">
                    <span class="nav-icon">üè≠</span>
                    <span>Supplier Mgmt</span>
                </div>
                <div class="nav-item" data-page="analytics" onclick="showPage('analytics'); adminPortalUI.initAnalyticsPage()">
                    <span class="nav-icon">üìà</span>
                    <span>Analytics</span>
                </div>
                <div class="nav-item" data-page="smartFeatures" onclick="showPage('smartFeatures'); adminPortalUI.initSmartFeaturesPage()">
                    <span class="nav-icon">‚ú®</span>
                    <span>Smart Features</span>
                </div>
            </nav>

            <div style="padding: 20px; border-top: 1px solid var(--border); margin-top: auto;">
                <div class="user-info" style="margin-bottom: 12px; padding: 12px; background: var(--light); border-radius: 8px;">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">Logged in as</div>
                    <div class="user-name" style="font-weight: 600; color: var(--primary);">Admin User</div>
                </div>
                <button class="btn btn-outline" style="width: 100%; margin-bottom: 8px;" onclick="EarlyBirdAuth.logout(); window.location.href='login.html'">
                    üö™ Logout
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Calendar Page -->
            <div id="calendarPage" class="page-content">
                <div class="page-header">
                    <div class="page-header-left">
                        <h2>üìÖ Admin Calendar</h2>
                        <p>Consolidated view of all operations across the system</p>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-outline" onclick="showPage('dataImport')">
                            üì• Data Import
                        </button>
                        <button class="btn btn-primary" onclick="Toast.info('Create order via Orders section', 'Navigation')">
                            ‚ûï Create Order
                        </button>
                    </div>
                </div>

                <div class="heat-map-legend">
                    <span class="legend-title">Delivery Volume (Heat Map)</span>
                    <div class="legend-items">
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--heat-low);"></div>
                            <span>1-20 deliveries</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--heat-medium);"></div>
                            <span>21-50 deliveries</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--heat-high);"></div>
                            <span>51-100 deliveries</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--heat-alert);"></div>
                            <span>100+ deliveries (Alert!)</span>
                        </div>
                    </div>
                </div>

                <div class="calendar-layout" style="display: flex; gap: 20px; min-height: 600px;">
                    <div class="calendar-container" style="flex: 1; max-width: 500px; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; display: flex; flex-direction: column;">
                        <div class="calendar-header" style="background: linear-gradient(135deg, #FF6B35 0%, #E85A2A 100%); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center;">
                            <h3 class="calendar-month-title" id="calendarMonthTitle" style="margin: 0; font-size: 18px;"></h3>
                            <div class="calendar-nav" style="display: flex; gap: 8px;">
                                <button onclick="changeMonth(-1)" style="padding: 6px 12px; background: rgba(255,255,255,0.2); border: none; color: white; border-radius: 4px; cursor: pointer;">‚óÄ</button>
                                <button onclick="changeMonth(0)" style="padding: 6px 12px; background: rgba(255,255,255,0.2); border: none; color: white; border-radius: 4px; cursor: pointer;">Today</button>
                                <button onclick="changeMonth(1)" style="padding: 6px 12px; background: rgba(255,255,255,0.2); border: none; color: white; border-radius: 4px; cursor: pointer;">‚ñ∂</button>
                            </div>
                        </div>
                        <div id="calendarGrid" style="flex: 1; overflow-y: auto; padding: 10px;"></div>
                    </div>
                    
                    <div class="date-detail-view" id="dateDetailView" style="flex: 1; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 20px; overflow-y: auto; max-height: 600px;">
                        <div style="color: #999; text-align: center; padding: 40px 20px;">üìÖ Select a date to view details</div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Page -->
            <div id="dashboardPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <div class="page-header-left">
                        <h2>üìä Dashboard</h2>
                        <p>Subscription-Centric Business Metrics (85% Recurring Revenue Focus)</p>
                    </div>
                </div>

                <!-- Revenue Model Badge -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
                    <div style="padding: 16px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border-radius: 12px; border-left: 4px solid var(--primary);">
                        <div style="font-size: 12px; font-weight: 700; color: var(--primary); margin-bottom: 4px;">üîÑ SUBSCRIPTIONS (Primary Revenue)</div>
                        <div style="font-size: 24px; font-weight: 700; color: var(--text-primary); margin-bottom: 4px;">85%</div>
                        <div style="font-size: 11px; color: var(--text-secondary);">Predictable recurring revenue</div>
                    </div>
                    <div style="padding: 16px; background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(56, 142, 60, 0.1) 100%); border-radius: 12px; border-left: 4px solid #4caf50;">
                        <div style="font-size: 12px; font-weight: 700; color: #2e7d32; margin-bottom: 4px;">üì¶ ORDERS (Ad-hoc Revenue)</div>
                        <div style="font-size: 24px; font-weight: 700; color: var(--text-primary); margin-bottom: 4px;">15%</div>
                        <div style="font-size: 11px; color: var(--text-secondary);">One-time purchases & seasonal</div>
                    </div>
                </div>

                <div class="stat-grid">
                    <div class="stat-card primary">
                        <div class="stat-label">Total Customers</div>
                        <div class="stat-value">1,247</div>
                        <div class="stat-change">+12% from last month</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-label">Active Subscriptions</div>
                        <div class="stat-value">892</div>
                        <div class="stat-change">+8% this week (PRIMARY)</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-label">Today's Orders</div>
                        <div class="stat-value">156</div>
                        <div class="stat-change">AM: 89 | PM: 67</div>
                    </div>
                    <div class="stat-card secondary">
                        <div class="stat-label">Today's Revenue</div>
                        <div class="stat-value">‚Çπ45,670</div>
                        <div class="stat-change">~‚Çπ38.8K from subscriptions</div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 20px;">Quick Actions</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                        <button class="btn btn-primary" onclick="showPage('orders'); switchSubscriptionTab('subscriptions')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-weight: 700;">üîÑ Manage Subscriptions</button>
                        <button class="btn btn-primary" onclick="showPage('customers')">üë• Add Customer</button>
                        <button class="btn btn-primary" onclick="showPage('orders'); switchSubscriptionTab('orders')">üì¶ Create Order</button>
                        <button class="btn btn-primary" onclick="showPage('dataImport')">üì• Import Data</button>
                    </div>
                </div>
            </div>

            <!-- Customers Page -->
            <div id="customersPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <div class="page-header-left">
                        <h2>üë• Customer Management</h2>
                        <p id="customerCount">Loading customers...</p>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="customerSearchInput" placeholder="Search customers..." 
                            onkeyup="adminPortalUI.searchCustomers()" 
                            style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px; width: 250px;">
                        <button class="btn btn-primary" onclick="adminPortalUI.showAddCustomerModal()">‚ûï Add Customer</button>
                    </div>
                </div>

                <div id="customersList" class="card">
                    <p style="text-align: center; color: var(--text-secondary);">Loading customers...</p>
                </div>
            </div>

            <div id="ordersPage" class="page-content" style="display: none;">
                <!-- Tab Navigation -->
                <div style="display: flex; gap: 12px; margin-bottom: 24px; border-bottom: 2px solid var(--border); padding-bottom: 0;">
                    <button class="btn-tab active" onclick="switchSubscriptionTab('subscriptions')" style="padding: 12px 20px; border: none; background: none; cursor: pointer; font-size: 14px; font-weight: 600; color: var(--text-secondary); border-bottom: 3px solid transparent; margin-bottom: -2px; transition: all 0.2s; flex-shrink: 0;" id="tab-subscriptions">
                        üîÑ Subscriptions (Primary Revenue)
                    </button>
                    <button class="btn-tab" onclick="switchSubscriptionTab('orders')" style="padding: 12px 20px; border: none; background: none; cursor: pointer; font-size: 14px; font-weight: 600; color: var(--text-secondary); border-bottom: 3px solid transparent; margin-bottom: -2px; transition: all 0.2s; flex-shrink: 0;" id="tab-orders">
                        üì¶ One-Time Orders (Ad-hoc)
                    </button>
                </div>

                <!-- SUBSCRIPTIONS TAB (PRIMARY) -->
                <div id="subscriptionsTabContent" style="display: block;">
                    <div class="page-header" style="margin-bottom: 24px;">
                        <div class="page-header-left">
                            <h2>üîÑ Subscription Management</h2>
                            <p>Manage recurring deliveries (Core Business Model)</p>
                        </div>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-primary" onclick="subscriptionIntegration.showCreateSubscriptionModal()">
                                üîÑ NEW Subscription
                            </button>
                            <button class="btn btn-success" onclick="subscriptionIntegration.showCreateOrderModal()">
                                üì¶ NEW Order
                            </button>
                        </div>
                    </div>

                    <!-- Subscription Filters -->
                    <div class="card" style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 16px;">Filters</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                            <div>
                                <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px;">Status</label>
                                <select id="subscriptionStatusFilter" onchange="adminPortalUI.loadSubscriptions()" 
                                    style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
                                    <option value="">All Subscriptions</option>
                                    <option value="active">Active</option>
                                    <option value="paused">Paused</option>
                                    <option value="cancelled">Cancelled</option>
                                    <option value="pending">Pending</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px;">Frequency</label>
                                <select id="subscriptionFreqFilter" onchange="adminPortalUI.loadSubscriptions()"
                                    style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
                                    <option value="">All Frequencies</option>
                                    <option value="daily">Daily</option>
                                    <option value="alternate_days">Alternate Days</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="biweekly">Bi-weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Subscription Summary Stats -->
                    <div class="stat-grid" style="margin-bottom: 20px;">
                        <div class="stat-card primary">
                            <div class="stat-label">Active Subscriptions</div>
                            <div class="stat-value" id="activeSubscriptions">0</div>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-label">Paused</div>
                            <div class="stat-value" id="pausedSubscriptions">0</div>
                        </div>
                        <div class="stat-card success">
                            <div class="stat-label">Monthly Revenue</div>
                            <div class="stat-value" id="subscriptionRevenue">‚Çπ0</div>
                        </div>
                    </div>

                    <!-- Subscriptions List -->
                    <div id="subscriptionsList" class="card">
                        <p style="text-align: center; color: var(--text-secondary);">Loading subscriptions...</p>
                    </div>
                </div>

                <!-- ORDERS TAB (SECONDARY) -->
                <div id="ordersTabContent" style="display: none;">
                    <div class="page-header" style="margin-bottom: 24px;">
                        <div class="page-header-left">
                            <h2>üì¶ One-Time Orders</h2>
                            <p id="orderCount">Ad-hoc purchases (non-recurring)</p>
                        </div>
                        <button class="btn btn-primary" onclick="subscriptionIntegration.showCreateOrderModal()">üì¶ NEW One-Time Order</button>
                    </div>

                    <div class="card" style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 16px;">Filters</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                            <div>
                                <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px;">Status</label>
                                <select id="orderStatusFilter" onchange="adminPortalUI.loadOrders()" 
                                    style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
                                    <option value="">All Orders</option>
                                    <option value="pending">Pending</option>
                                    <option value="assigned">Assigned</option>
                                    <option value="delivered">Delivered</option>
                                    <option value="failed">Failed</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px;">Date</label>
                                <input type="date" id="orderDateFilter" onchange="adminPortalUI.loadOrders()"
                                    style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
                            </div>
                        </div>
                    </div>

                    <div id="ordersList" class="card">
                        <p style="text-align: center; color: var(--text-secondary);">Loading orders...</p>
                    </div>
                </div>
            </div>

            <div id="deliveriesPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <div class="page-header-left">
                        <h2>üöö Order Delivery & Billing Management</h2>
                        <p>Full order delivery tracking with billing, payment status and all filters</p>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-primary" onclick="deliveryManagementUI.exportToExcel()">üì• Export Excel</button>
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="card" style="margin-bottom: 20px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);">
                    <h3 style="margin-bottom: 16px; color: #667eea; display: flex; align-items: center; gap: 8px;">
                        üîç Advanced Filters
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-bottom: 16px;">
                        <!-- Month Selector -->
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: var(--text-secondary);">üìÖ Select Month</label>
                            <input type="month" id="deliveryMonth" onchange="deliveryManagementUI.loadDeliveries()"
                                style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;">
                        </div>

                        <!-- Customer Name Search -->
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: var(--text-secondary);">üë§ Customer Name</label>
                            <input type="text" id="customerNameSearch" placeholder="Search customer name..." 
                                onkeyup="deliveryManagementUI.applyFilters()"
                                style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;">
                        </div>

                        <!-- Mobile Number Search -->
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: var(--text-secondary);">üì± Mobile Number</label>
                            <input type="text" id="mobileSearch" placeholder="Search mobile..." 
                                onkeyup="deliveryManagementUI.applyFilters()"
                                style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;">
                        </div>

                        <!-- Area Filter -->
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: var(--text-secondary);">üó∫Ô∏è Area</label>
                            <select id="deliveryAreaFilter" onchange="deliveryManagementUI.applyFilters()"
                                style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;">
                                <option value="">All Areas</option>
                            </select>
                        </div>

                        <!-- Delivery Boy Filter -->
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: var(--text-secondary);">üöö Delivery Boy</label>
                            <select id="deliveryBoyFilter" onchange="deliveryManagementUI.applyFilters()"
                                style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;">
                                <option value="">All Delivery Boys</option>
                            </select>
                        </div>

                        <!-- Subscription Type Filter -->
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: var(--text-secondary);">üîÑ Subscription Type</label>
                            <select id="subscriptionTypeFilter" onchange="deliveryManagementUI.applyFilters()"
                                style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;">
                                <option value="">All Types</option>
                                <option value="daily">Daily</option>
                                <option value="alternate">Alternate Days</option>
                                <option value="weekly">Weekly</option>
                                <option value="biweekly">Bi-Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>

                        <!-- Marketing Boy Filter -->
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: var(--text-secondary);">üì¢ Marketing Boy</label>
                            <select id="marketingBoyFilter" onchange="deliveryManagementUI.applyFilters()"
                                style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;">
                                <option value="">All Marketing Boys</option>
                            </select>
                        </div>

                        <!-- Payment Status Filter -->
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: var(--text-secondary);">üí≥ Payment Status</label>
                            <select id="paymentStatusFilter" onchange="deliveryManagementUI.applyFilters()"
                                style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="partial">Partial</option>
                                <option value="paid">Paid</option>
                            </select>
                        </div>

                        <!-- Delivery Status Filter -->
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px; color: var(--text-secondary);">üì¶ Delivery Status</label>
                            <select id="deliveryStatusFilter" onchange="deliveryManagementUI.applyFilters()"
                                style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="assigned">Assigned</option>
                                <option value="delivered">Delivered</option>
                                <option value="failed">Failed</option>
                            </select>
                        </div>
                    </div>

                    <!-- Clear Filters Button -->
                    <button onclick="deliveryManagementUI.clearFilters()" 
                        style="padding: 8px 16px; background: var(--light); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                        üîÑ Clear All Filters
                    </button>
                </div>

                <!-- Summary Cards -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 20px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 16px; border-radius: 8px;">
                        <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">üìä Total Orders</div>
                        <div id="totalOrdersSummary" style="font-size: 28px; font-weight: 700;">-</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #FF9800 0%, #E85A2A 100%); color: white; padding: 16px; border-radius: 8px;">
                        <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">‚è≥ Pending Payment</div>
                        <div id="pendingPaymentSummary" style="font-size: 28px; font-weight: 700;">‚Çπ-</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); color: white; padding: 16px; border-radius: 8px;">
                        <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">üí∞ Total Amount</div>
                        <div id="totalAmountSummary" style="font-size: 28px; font-weight: 700;">‚Çπ-</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%); color: white; padding: 16px; border-radius: 8px;">
                        <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">‚úì Delivered</div>
                        <div id="deliveredCountSummary" style="font-size: 28px; font-weight: 700;">-</div>
                    </div>
                </div>

                <!-- Main Grid Table -->
                <div class="card" style="overflow-x: auto;">
                    <div id="deliveryGrid" style="min-width: 1400px;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 12px;">
                            <thead>
                                <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; position: sticky; top: 0;">
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Order ID</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Customer</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Mobile</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Area</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Product</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Qty</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Subscription</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Total</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Payment Status</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Delivery Status</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Delivery Boy</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Marketing Boy</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Date</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="deliveryTableBody">
                                <tr>
                                    <td colspan="14" style="padding: 20px; text-align: center; color: var(--text-secondary);">Loading delivery data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Billing & Invoices Page -->
            <div id="billingPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <div class="page-header-left">
                        <h2>üí≥ Billing & Invoices</h2>
                        <p>Customer billing management and invoice generation</p>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="billingSearchInput" placeholder="Search by customer or order..." 
                            onkeyup="adminPortalUI.searchBilling()" 
                            style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px; width: 250px;">
                        <select id="billingStatusFilter" onchange="adminPortalUI.loadBillingView()"
                            style="padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px;">
                            <option value="">All Payment Status</option>
                            <option value="pending">Pending</option>
                            <option value="partial">Partial</option>
                            <option value="paid">Paid</option>
                        </select>
                    </div>
                </div>

                <div id="billingGrid" class="card">
                    <p style="text-align: center; color: var(--text-secondary);">Loading billing data...</p>
                </div>
            </div>

            <div id="staffPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <div class="page-header-left">
                        <h2>üëî Staff Management</h2>
                        <p>Commission tracking and performance metrics</p>
                    </div>
                    <button class="btn btn-primary" onclick="adminPortalUI.loadStaff()">üîÑ Refresh</button>
                </div>

                <div class="card" style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 16px;">Performance Summary</h3>
                    <div class="stat-grid">
                        <div class="summary-box">
                            <div class="summary-label">Total Staff</div>
                            <div class="summary-value" id="totalStaff">-</div>
                        </div>
                        <div class="summary-box">
                            <div class="summary-label">Today's Earnings</div>
                            <div class="summary-value" id="todayEarnings">‚Çπ-</div>
                        </div>
                        <div class="summary-box">
                            <div class="summary-label">Total Paid Out</div>
                            <div class="summary-value" id="totalPaidOut">‚Çπ-</div>
                        </div>
                        <div class="summary-box">
                            <div class="summary-label">Pending Withdrawals</div>
                            <div class="summary-value" id="pendingWithdrawals">‚Çπ-</div>
                        </div>
                    </div>
                </div>

                <div id="staffList" class="card">
                    <h3 style="margin-bottom: 16px;">Staff Commissions</h3>
                    <p style="text-align: center; color: var(--text-secondary);">Loading staff data...</p>
                </div>
            </div>

            <div id="areasPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <div class="page-header-left">
                        <h2>üó∫Ô∏è Area Management</h2>
                        <p>Manage delivery areas, sub-areas, and assign delivery boys</p>
                    </div>
                    <button class="btn btn-primary" onclick="areaManagementUI.showAddAreaModal()">‚ûï Add Area</button>
                </div>

                <!-- Areas Summary Cards -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 20px;">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 16px; border-radius: 8px;">
                        <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">üìç Total Areas</div>
                        <div id="totalAreasSummary" style="font-size: 28px; font-weight: 700;">-</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #FF9800 0%, #E85A2A 100%); color: white; padding: 16px; border-radius: 8px;">
                        <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">üóÇÔ∏è Total Sub-Areas</div>
                        <div id="totalSubAreasSummary" style="font-size: 28px; font-weight: 700;">-</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); color: white; padding: 16px; border-radius: 8px;">
                        <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">üöö Total Delivery Boys</div>
                        <div id="totalDeliveryBoysSummary" style="font-size: 28px; font-weight: 700;">-</div>
                    </div>
                </div>

                <!-- Areas Grid -->
                <div class="card" style="overflow-x: auto;">
                    <div id="areasGrid" style="min-width: 1000px;">
                        <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                            <thead>
                                <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Area Name</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Sub-Areas</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Assigned Delivery Boys</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600; border-right: 1px solid rgba(255,255,255,0.2);">Status</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="areasTableBody">
                                <tr>
                                    <td colspan="5" style="padding: 20px; text-align: center; color: var(--text-secondary);">Loading areas...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Data Import Page -->
            <div id="dataImportPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <div class="page-header-left">
                        <h2>üì• Data Import</h2>
                        <p>Import customer and delivery data from Excel file</p>
                    </div>
                </div>

                <!-- Step 1: Download Template -->
                <div class="card" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border-left: 4px solid #667eea; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <h3 style="margin: 0 0 8px 0; color: #667eea;">üìã Step 1: Download Template</h3>
                            <p style="margin: 0; font-size: 13px; color: var(--text-secondary);">Download the Excel template with instructions and sample format for importing data</p>
                        </div>
                        <button class="btn btn-primary" style="white-space: nowrap; margin-left: 20px;" onclick="adminPortalUI.downloadImportTemplate()">
                            üì• Download Template
                        </button>
                    </div>
                    <div style="margin-top: 12px; padding: 12px; background: white; border-radius: 6px; font-size: 12px; color: #666;">
                        <strong>Template includes:</strong> Delivery data columns (Customer ID, Name, Phone, Area, Product, Quantity, Delivery Date, Payment Status, Delivery Boy, etc.)
                    </div>
                </div>

                <!-- Step 2: Import Data -->
                <div class="card" style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 16px;">üì§ Step 2: Import Your Data</h3>
                    
                    <div style="border: 2px solid var(--border); border-radius: 8px; padding: 24px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);">
                        <div style="text-align: center;">
                            <div style="font-size: 48px; margin-bottom: 12px;">üìä</div>
                            <h4 style="margin: 0 0 8px 0; color: #667eea; font-size: 16px;">Universal Data Import</h4>
                            <p style="margin: 0 0 20px 0; font-size: 13px; color: var(--text-secondary);">Upload your Excel file with customer and delivery data. All data types will be imported automatically.</p>
                            
                            <div style="margin-bottom: 20px;">
                                <input type="file" id="importFileInput" accept=".xlsx,.xls,.csv" style="display: none;">
                                <button class="btn btn-primary" style="padding: 12px 24px; font-size: 14px; cursor: pointer;" onclick="document.getElementById('importFileInput').click()">
                                    ‚úì Select File to Import
                                </button>
                                <div id="fileStatus" style="margin-top: 12px; font-size: 13px; color: var(--text-secondary); display: none;">
                                    <span id="fileName"></span>
                                </div>
                            </div>

                            <div id="importProgress" style="display: none; margin-top: 16px;">
                                <div style="background: var(--light); padding: 12px; border-radius: 6px; margin-bottom: 12px;">
                                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">Importing...</div>
                                    <div style="height: 6px; background: #ddd; border-radius: 3px; overflow: hidden;">
                                        <div id="progressBar" style="height: 100%; background: #667eea; width: 0%; transition: width 0.3s;"></div>
                                    </div>
                                </div>
                                <div id="importStats" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                                    <div style="background: white; padding: 8px; border-radius: 4px; text-align: center;">
                                        <div style="font-size: 12px; color: var(--text-secondary);">Rows Read</div>
                                        <div style="font-size: 18px; font-weight: 600; color: #667eea;" id="rowCount">0</div>
                                    </div>
                                    <div style="background: white; padding: 8px; border-radius: 4px; text-align: center;">
                                        <div style="font-size: 12px; color: var(--text-secondary);">Imported</div>
                                        <div style="font-size: 18px; font-weight: 600; color: #4CAF50;" id="importedCount">0</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Import Status & Feedback -->
                            <div id="importStatus" style="display: none; margin-top: 16px; padding: 12px; border-radius: 6px; background: #E3F2FD; border-left: 4px solid #2196F3; font-size: 13px;">
                                <strong style="color: #1976D2;">üìã Import Status:</strong>
                                <span id="statusText" style="margin-left: 8px;"></span>
                            </div>

                            <!-- Import Errors (if any) -->
                            <div id="importErrors" style="display: none; margin-top: 12px; padding: 12px; border-radius: 6px; background: #FFEBEE; border-left: 4px solid #F44336; font-size: 13px;">
                                <strong style="color: #C62828;">‚ö†Ô∏è Validation Errors Found:</strong>
                                <ul id="errorList" style="margin: 8px 0 0 20px; padding: 0; font-size: 12px; color: #B71C1C;"></ul>
                            </div>

                            <!-- Import Warnings (if any) -->
                            <div id="importWarnings" style="display: none; margin-top: 12px; padding: 12px; border-radius: 6px; background: #FFF3E0; border-left: 4px solid #FF9800; font-size: 13px;">
                                <strong style="color: #E65100;">‚ö° Data Quality Warnings:</strong>
                                <ul id="warningList" style="margin: 8px 0 0 20px; padding: 0; font-size: 12px; color: #BF360C;"></ul>
                            </div>

                            <!-- Import Success -->
                            <div id="importResult" style="display: none; margin-top: 16px; padding: 12px; border-radius: 6px; font-size: 13px;">
                            </div>

                            <!-- Detailed Summary -->
                            <div id="importSummary" style="display: none; margin-top: 16px; padding: 16px; border-radius: 6px; background: white; border: 1px solid #ddd;">
                                <h4 style="margin: 0 0 12px 0; color: #333;">üìä Import Summary</h4>
                                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; font-size: 12px;">
                                    <div>
                                        <span style="color: var(--text-secondary);">Data Type Detected:</span>
                                        <div style="font-weight: 600; color: #667eea;" id="summaryType">-</div>
                                    </div>
                                    <div>
                                        <span style="color: var(--text-secondary);">File Name:</span>
                                        <div style="font-weight: 600;" id="summaryFile">-</div>
                                    </div>
                                    <div>
                                        <span style="color: var(--text-secondary);">Records Read:</span>
                                        <div style="font-weight: 600; color: #2196F3;" id="summaryReadCount">0</div>
                                    </div>
                                    <div>
                                        <span style="color: var(--text-secondary);">Records Imported:</span>
                                        <div style="font-weight: 600; color: #4CAF50;" id="summaryImportedCount">0</div>
                                    </div>
                                    <div id="summaryErrorsDiv" style="display: none;">
                                        <span style="color: var(--text-secondary);">Failed Records:</span>
                                        <div style="font-weight: 600; color: #F44336;" id="summaryErrorCount">0</div>
                                    </div>
                                    <div id="summaryTimestampDiv">
                                        <span style="color: var(--text-secondary);">Imported At:</span>
                                        <div style="font-weight: 600;" id="summaryTimestamp">-</div>
                                    </div>
                                </div>
                                <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #eee;">
                                    <button class="btn btn-sm btn-outline" style="padding: 6px 12px; font-size: 11px;" onclick="downloadImportReport()">üì• Download Report</button>
                                    <button class="btn btn-sm btn-outline" style="padding: 6px 12px; font-size: 11px; margin-left: 8px;" onclick="clearImportResults()">üîÑ Clear Results</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Load Demo Data -->
                <div class="card" style="background: #FFF3E0; border-left: 4px solid #F57C00;">
                    <h3 style="margin: 0 0 12px 0; color: #F57C00;">‚ö° Quick Demo</h3>
                    <p style="margin: 0 0 12px 0; font-size: 13px; color: var(--text-secondary);">Load sample data to test the system without preparing an import file</p>
                    <button class="btn btn-outline" style="padding: 10px 20px; border-color: #F57C00; color: #F57C00;" onclick="adminPortalUI.loadSampleData()">
                        üéØ Load Sample Data
                    </button>
                </div>

                <!-- Import Instructions -->
                <div class="card">
                    <h3 style="margin-bottom: 16px;">üìö How to Import</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div>
                            <h4 style="color: #667eea; margin: 0 0 8px 0;">1. Download</h4>
                            <p style="margin: 0; font-size: 12px; color: var(--text-secondary);">Click "Download Template" to get the Excel file with required columns</p>
                        </div>
                        <div>
                            <h4 style="color: #667eea; margin: 0 0 8px 0;">2. Fill Data</h4>
                            <p style="margin: 0; font-size: 12px; color: var(--text-secondary);">Enter your customer and delivery data following the column headers</p>
                        </div>
                        <div>
                            <h4 style="color: #667eea; margin: 0 0 8px 0;">3. Select File</h4>
                            <p style="margin: 0; font-size: 12px; color: var(--text-secondary);">Click "Select File to Import" and choose your completed Excel file</p>
                        </div>
                        <div>
                            <h4 style="color: #667eea; margin: 0 0 8px 0;">4. Import</h4>
                            <p style="margin: 0; font-size: 12px; color: var(--text-secondary);">System will automatically process and import all your data</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="suppliersPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <div class="page-header-left">
                        <h2>üè≠ Supplier Management</h2>
                        <p>Manage suppliers and inventory</p>
                    </div>
                    <button class="btn btn-primary" onclick="adminPortalUI.showAddSupplierModal()">‚ûï Add Supplier</button>
                </div>

                <div style="margin-bottom: 20px;">
                    <input type="text" id="supplierSearch" placeholder="üîç Search suppliers by name..." style="width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px;" onkeyup="adminPortalUI.filterSuppliers()">
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 16px;">üìã Active Suppliers</h3>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--light); border-bottom: 2px solid var(--border);">
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Supplier Name</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Category</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Location</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600;">Orders (30d)</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600;">Total Billed</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600;">Status</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="suppliersTableBody">
                                <tr>
                                    <td colspan="7" style="padding: 32px; text-align: center; color: var(--text-secondary);">
                                        <p>Loading suppliers...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 16px;">üì¶ Recent Supplier Orders</h3>
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--light); border-bottom: 2px solid var(--border);">
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Supplier</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Order Items</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600;">Order Value</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600;">Date</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600;">Status</th>
                                </tr>
                            </thead>
                            <tbody id="supplierOrdersBody">
                                <tr>
                                    <td colspan="5" style="padding: 32px; text-align: center; color: var(--text-secondary);">
                                        <p>Loading recent orders...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Add Supplier Modal -->
                <div id="addSupplierModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
                    <div style="background: white; border-radius: 12px; padding: 32px; max-width: 500px; width: 90%;">
                        <h3 style="margin-bottom: 20px;">‚ûï Add New Supplier</h3>
                        <input type="text" id="supplierNameInput" placeholder="Supplier Name" style="width: 100%; padding: 10px; margin-bottom: 12px; border: 1px solid var(--border); border-radius: 6px;">
                        <input type="text" id="supplierCategoryInput" placeholder="Category (e.g., Electronics, Groceries)" style="width: 100%; padding: 10px; margin-bottom: 12px; border: 1px solid var(--border); border-radius: 6px;">
                        <input type="text" id="supplierLocationInput" placeholder="Location/City" style="width: 100%; padding: 10px; margin-bottom: 12px; border: 1px solid var(--border); border-radius: 6px;">
                        <input type="email" id="supplierEmailInput" placeholder="Email" style="width: 100%; padding: 10px; margin-bottom: 12px; border: 1px solid var(--border); border-radius: 6px;">
                        <input type="tel" id="supplierPhoneInput" placeholder="Phone Number" style="width: 100%; padding: 10px; margin-bottom: 20px; border: 1px solid var(--border); border-radius: 6px;">
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-primary" style="flex: 1;" onclick="adminPortalUI.saveNewSupplier()">Save Supplier</button>
                            <button class="btn btn-outline" style="flex: 1;" onclick="adminPortalUI.closeAddSupplierModal()">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="walletsPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <div class="page-header-left">
                        <h2>üí∞ Financial Dashboard</h2>
                        <p>Revenue, commissions, and financial overview</p>
                    </div>
                    <button class="btn btn-primary" onclick="adminPortalUI.loadFinancials()">üîÑ Refresh</button>
                </div>

                <div class="stat-grid" style="margin-bottom: 20px;">
                    <div class="stat-card primary">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-value" id="totalRevenue">‚Çπ-</div>
                        <div class="stat-change" id="totalRevenueChange">Today</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-label">Staff Commissions</div>
                        <div class="stat-value" id="staffCommissions">‚Çπ-</div>
                        <div class="stat-change">Paid out</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-label">Customer Wallets</div>
                        <div class="stat-value" id="customerWalletBalance">‚Çπ-</div>
                        <div class="stat-change">Active balance</div>
                    </div>
                    <div class="stat-card secondary">
                        <div class="stat-label">Net Profit</div>
                        <div class="stat-value" id="netProfit">‚Çπ-</div>
                        <div class="stat-change">After costs</div>
                    </div>
                </div>

                <div id="financialReport" class="card">
                    <h3 style="margin-bottom: 16px;">Breakdown by Category</h3>
                    <p style="text-align: center; color: var(--text-secondary);">Loading financial data...</p>
                </div>
            </div>

            <!-- Monthly Billing Page -->
            <div id="monthlyBillingPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <div class="page-header-left">
                        <h2>üìä Monthly Billing</h2>
                        <p>Excel-like grid for bulk editing and billing management</p>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <button class="btn btn-outline" id="toggleViewBtn" onclick="monthlyBillingUI.toggleView()">
                            üëÅÔ∏è Switch to Billing View
                        </button>
                        <button class="btn btn-primary" onclick="monthlyBillingUI.exportToExcel()">
                            üì• Export Excel
                        </button>
                    </div>
                </div>

                <!-- Month Selector & Filters -->
                <div class="card" style="margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px;">Select Month</label>
                            <input type="month" id="billingMonth" onchange="monthlyBillingUI.loadMonth()"
                                style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px;">Filter by Area</label>
                            <select id="areaFilter" onchange="monthlyBillingUI.applyFilters()"
                                style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;">
                                <option value="">All Areas</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px;">Payment Status</label>
                            <select id="paymentFilter" onchange="monthlyBillingUI.applyFilters()"
                                style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;">
                                <option value="all">All</option>
                                <option value="paid">Paid</option>
                                <option value="pending">Pending</option>
                                <option value="partial">Partial</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px;">Product Filters</label>
                            <div id="productFilters" style="display: flex; flex-wrap: wrap; gap: 8px; padding-top: 6px;">
                                <!-- Product checkboxes will be rendered here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Edit View (Grid) -->
                <div id="editViewContainer" class="card" style="overflow-x: auto;">
                    <div style="min-width: 1200px;">
                        <table id="billingGrid" style="width: 100%; border-collapse: collapse; font-size: 13px;">
                            <thead>
                                <tr style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                    <th style="padding: 12px; text-align: left; position: sticky; left: 0; background: inherit; z-index: 2;">Customer</th>
                                    <th style="padding: 12px; text-align: left;">Area</th>
                                    <th style="padding: 12px; text-align: left;">Delivery Boy</th>
                                    <th style="padding: 12px; text-align: left;">Shift</th>
                                    <!-- Day columns will be added dynamically -->
                                </tr>
                            </thead>
                            <tbody id="billingGridBody">
                                <tr>
                                    <td colspan="100" style="padding: 40px; text-align: center; color: var(--text-secondary);">
                                        Select a month to load billing data
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Billing View (Summary) -->
                <div id="billingViewContainer" class="card" style="display: none; overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white;">
                                <th style="padding: 12px; text-align: left;">Customer</th>
                                <th style="padding: 12px; text-align: right;">Week 1</th>
                                <th style="padding: 12px; text-align: right;">Week 2</th>
                                <th style="padding: 12px; text-align: right;">Week 3</th>
                                <th style="padding: 12px; text-align: right;">Week 4</th>
                                <th style="padding: 12px; text-align: right;">Total Bill</th>
                                <th style="padding: 12px; text-align: right;">Paid</th>
                                <th style="padding: 12px; text-align: right;">Balance</th>
                                <th style="padding: 12px; text-align: center;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="billingViewBody">
                            <tr>
                                <td colspan="9" style="padding: 40px; text-align: center; color: var(--text-secondary);">
                                    Switch to Billing View to see summary
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- User Management Page -->
            <div id="usersPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <div class="page-header-left">
                        <h2>üë• User Management</h2>
                        <p>Manage all system users and access control</p>
                    </div>
                    <button class="btn btn-primary" onclick="userManagementUI.showAddUserModal()">
                        ‚ûï Add User
                    </button>
                </div>

                <!-- User Stats -->
                <div class="stat-grid" style="margin-bottom: 20px;">
                    <div class="stat-card primary">
                        <div class="stat-label">Total Users</div>
                        <div class="stat-value" id="totalUsers">0</div>
                        <div class="stat-change">All roles</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-label">Customers</div>
                        <div class="stat-value" id="totalCustomers">0</div>
                        <div class="stat-change">Active users</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-label">Delivery Boys</div>
                        <div class="stat-value" id="totalDeliveryBoys">0</div>
                        <div class="stat-change">On duty</div>
                    </div>
                    <div class="stat-card secondary">
                        <div class="stat-label">Staff</div>
                        <div class="stat-value" id="totalStaff">0</div>
                        <div class="stat-change">Admin + Marketing</div>
                    </div>
                </div>

                <!-- Role Filter -->
                <div class="card" style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 600;">Filter by Role</label>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="btn btn-sm active" onclick="userManagementUI.filterByRole('')">All</button>
                        <button class="btn btn-sm btn-outline" onclick="userManagementUI.filterByRole('admin')">üë®‚Äçüíº Admin</button>
                        <button class="btn btn-sm btn-outline" onclick="userManagementUI.filterByRole('customer')">üë§ Customers</button>
                        <button class="btn btn-sm btn-outline" onclick="userManagementUI.filterByRole('delivery_boy')">üöö Delivery Boys</button>
                        <button class="btn btn-sm btn-outline" onclick="userManagementUI.filterByRole('marketing_staff')">üì¢ Marketing</button>
                        <button class="btn btn-sm btn-outline" onclick="userManagementUI.filterByRole('supplier')">üè≠ Suppliers</button>
                    </div>
                </div>

                <!-- Users Table -->
                <div class="card">
                    <div style="overflow-x: auto;">
                        <table id="usersTable" style="width: 100%; border-collapse: collapse; font-size: 14px;">
                            <thead>
                                <tr style="background: var(--light); border-bottom: 2px solid var(--border);">
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Name</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Email</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Phone</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Role</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Status</th>
                                    <th style="padding: 12px; text-align: left; font-weight: 600;">Created</th>
                                    <th style="padding: 12px; text-align: center; font-weight: 600;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <tr>
                                    <td colspan="7" style="padding: 40px; text-align: center; color: var(--text-secondary);">
                                        Loading users...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Phase 3: Supplier Management Page -->
            <div id="supplierPage" class="page-content" style="display: none;"></div>

            <!-- Phase 3: Analytics Page -->
            <div id="analyticsPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <div class="page-header-left">
                        <h2>üìà Analytics & Insights</h2>
                        <p>Business intelligence and performance metrics</p>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-bottom: 24px;">
                    <div class="stat-card primary">
                        <div class="stat-label">Total Revenue (30 Days)</div>
                        <div class="stat-value">‚Çπ2,45,680</div>
                        <div class="stat-change">+15% from last period</div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-label">Active Subscriptions</div>
                        <div class="stat-value">892</div>
                        <div class="stat-change">+8% this week</div>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-label">One-time Orders</div>
                        <div class="stat-value">156</div>
                        <div class="stat-change">15% of revenue</div>
                    </div>
                    <div class="stat-card secondary">
                        <div class="stat-label">Avg Customer LTV</div>
                        <div class="stat-value">‚Çπ8,450</div>
                        <div class="stat-change">+12% YoY</div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 20px;">üìä Key Performance Indicators</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px;">Monthly Recurring Revenue (MRR)</div>
                            <div style="font-size: 28px; font-weight: 700; color: var(--primary);">‚Çπ2,08,560</div>
                            <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 8px;">85% of total revenue</div>
                        </div>
                        <div>
                            <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px;">Churn Rate</div>
                            <div style="font-size: 28px; font-weight: 700; color: #10b981;">2.3%</div>
                            <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 8px;">Monthly customer loss</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 3: Smart Features Page -->
            <div id="smartFeaturesPage" class="page-content" style="display: none;">
                <div class="page-header">
                    <div class="page-header-left">
                        <h2>‚ú® Smart Features & AI</h2>
                        <p>Advanced capabilities for business automation</p>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="card">
                        <div style="font-size: 24px; margin-bottom: 12px;">üé§</div>
                        <h3 style="margin-bottom: 8px;">Voice Recognition</h3>
                        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 16px;">Place orders using voice commands. Multi-language support for Indian languages.</p>
                        <button class="btn btn-primary" onclick="alert('Voice feature coming soon')">Enable Voice</button>
                    </div>

                    <div class="card">
                        <div style="font-size: 24px; margin-bottom: 12px;">üì∏</div>
                        <h3 style="margin-bottom: 8px;">Image Recognition (OCR)</h3>
                        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 16px;">Upload product images to automatically detect items and create orders.</p>
                        <button class="btn btn-primary" onclick="alert('OCR feature coming soon')">Enable OCR</button>
                    </div>

                    <div class="card">
                        <div style="font-size: 24px; margin-bottom: 12px;">ü§ñ</div>
                        <h3 style="margin-bottom: 8px;">Demand Forecasting</h3>
                        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 16px;">AI predicts customer demand and suggests optimal subscription quantities.</p>
                        <button class="btn btn-primary" onclick="alert('Forecasting feature coming soon')">View Predictions</button>
                    </div>

                    <div class="card">
                        <div style="font-size: 24px; margin-bottom: 12px;">‚è∏Ô∏è</div>
                        <h3 style="margin-bottom: 8px;">Pause Detection</h3>
                        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 16px;">Automatically detect customer churn patterns and intervene proactively.</p>
                        <button class="btn btn-primary" onclick="alert('Pause detection feature coming soon')">Configure Alerts</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Authentication Module -->
    <script src="../../backend/auth.js"></script>

    <!-- Phase 1-2: Core Modules -->
    <script src="../../backend/utils.js"></script>
    <script src="../../backend/subscription.js"></script>
    <script src="../../backend/orders.js"></script>
    <script src="../../backend/delivery.js"></script>
    <script src="../../backend/wallet.js"></script>
    <script src="../../backend/payment-links.js"></script>
    <script src="../../backend/calendar.js"></script>
    <script src="../../backend/demand-forecast.js"></script>
    <script src="../../backend/pause-detection.js"></script>
    <script src="../../backend/supplier.js"></script>
    <script src="../../backend/shared-access.js"></script>

    <!-- Backend Processors -->
    <script src="../../backend/voice-processor.js"></script>
    <script src="../../backend/ocr-processor.js"></script>
    
    <!-- Phase 3: Intelligent Input & Smart Features -->
    <script src="../features/voice.js"></script>
    <script src="../features/image-ocr.js"></script>
    <script src="../features/smart-features.js"></script>

    <!-- Phase 3: Supplier Integration & Analytics -->
    <script src="../features/supplier.js"></script>
    <script src="../features/admin-ui.js"></script>
    <script src="../features/analytics.js"></script>

    <!-- Phase 3: Frontend UI Controller -->
    <script src="../features/phase3-ui.js"></script>

    <!-- Monthly Billing Grid -->
    <script src="../features/monthly-billing.js"></script>

    <!-- User Management -->
    <script src="../features/user-management.js"></script>

    <!-- Subscription Integration -->
    <script src="../features/subscription-integration.js"></script>

    <script>
        // Global Toast notification system
        const Toast = {
            info: function(message, title) {
                this.show(message, title, 'info');
            },
            success: function(message, title) {
                this.show(message, title, 'success');
            },
            warning: function(message, title) {
                this.show(message, title, 'warning');
            },
            error: function(message, title) {
                this.show(message, title, 'error');
            },
            show: function(message, title, type) {
                console.log(`[${title || type.toUpperCase()}] ${message}`);
                // Create a simple toast
                const toast = document.createElement('div');
                toast.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: ${this.getColor(type)};
                    color: white;
                    padding: 15px 20px;
                    border-radius: 4px;
                    z-index: 10001;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                    font-family: system-ui, -apple-system, sans-serif;
                    max-width: 300px;
                `;
                toast.innerHTML = `<strong>${title || type}</strong><br>${message}`;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            },
            getColor: function(type) {
                const colors = {
                    success: '#4CAF50',
                    error: '#F44336',
                    warning: '#FF9800',
                    info: '#2196F3'
                };
                return colors[type] || colors.info;
            }
        };

        // Helper function for showToast - delegates to Toast object
        function showToast(message, type) {
            Toast.show(message, null, type || 'info');
        }

        // ============================================
        // EARLY PAGE NAVIGATION (needed before HTML onclick handlers)
        // ============================================
        function setActiveNav(pageId) {
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to selected nav item
            const activeItem = document.querySelector(`[data-page="${pageId}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
        }

        // Initialize calendar
        function initCalendar() {
            try {
                if (typeof calendarManager !== 'undefined' && calendarManager.render) {
                    calendarManager.render();
                }
            } catch (error) {
                console.warn('Calendar initialization:', error);
            }
        }

        // Page navigation - Define early so onclick handlers can use it
        function showPage(pageId) {
            try {
                // Hide all pages
                document.querySelectorAll('.page-content').forEach(page => {
                    page.style.display = 'none';
                });
                
                // Show selected page
                const page = document.getElementById(pageId + 'Page');
                if (page) {
                    page.style.display = 'block';
                }
                
                // Update nav
                setActiveNav(pageId);
                
                // Re-initialize based on page
                if (pageId === 'calendar') {
                    setTimeout(() => {
                        try {
                            initCalendar();
                        } catch (e) {
                            console.warn('Calendar init error:', e);
                        }
                    }, 50);
                } else if (pageId === 'customers') {
                    try {
                        if (typeof adminPortalUI !== 'undefined' && adminPortalUI.loadCustomers) {
                            adminPortalUI.loadCustomers();
                        }
                    } catch (e) {
                        console.warn('Load customers error:', e);
                    }
                } else if (pageId === 'orders') {
                    try {
                        // Show subscriptions tab by default (primary revenue model)
                        switchSubscriptionTab('subscriptions');
                    } catch (e) {
                        console.warn('Switch subscription tab error:', e);
                    }
                } else if (pageId === 'deliveries') {
                    try {
                        // Set default month to current month
                        const now = new Date();
                        const monthInput = document.getElementById('deliveryMonth');
                        if (monthInput) {
                            monthInput.value = now.toISOString().slice(0, 7);
                        }
                        if (typeof deliveryManagementUI !== 'undefined') {
                            deliveryManagementUI.loadDeliveries();
                        }
                    } catch (e) {
                        console.warn('Deliveries error:', e);
                    }
                } else if (pageId === 'areas') {
                    try {
                        if (typeof areaManagementUI !== 'undefined') {
                            areaManagementUI.loadAreas();
                        }
                    } catch (e) {
                        console.warn('Areas error:', e);
                    }
                } else if (pageId === 'staff') {
                    try {
                        if (typeof adminPortalUI !== 'undefined' && adminPortalUI.loadStaff) {
                            adminPortalUI.loadStaff();
                        }
                    } catch (e) {
                        console.warn('Staff error:', e);
                    }
                } else if (pageId === 'wallets') {
                    try {
                        if (typeof adminPortalUI !== 'undefined' && adminPortalUI.loadFinancials) {
                            adminPortalUI.loadFinancials();
                        }
                    } catch (e) {
                        console.warn('Wallets error:', e);
                    }
                }
            } catch (error) {
                console.error('Page navigation error:', error);
            }
        }

        // Tab switching for Subscriptions & Orders
        function switchSubscriptionTab(tabName) {
            // Hide both tab contents
            const subsContent = document.getElementById('subscriptionsTabContent');
            const ordersContent = document.getElementById('ordersTabContent');
            if (subsContent) subsContent.style.display = 'none';
            if (ordersContent) ordersContent.style.display = 'none';
            
            // Remove active state from all tabs
            const tabSubs = document.getElementById('tab-subscriptions');
            const tabOrders = document.getElementById('tab-orders');
            if (tabSubs) tabSubs.classList.remove('active');
            if (tabOrders) tabOrders.classList.remove('active');
            if (tabSubs) tabSubs.style.borderBottomColor = 'transparent';
            if (tabOrders) tabOrders.style.borderBottomColor = 'transparent';
            
            // Show selected tab
            if (tabName === 'subscriptions') {
                if (subsContent) subsContent.style.display = 'block';
                if (tabSubs) {
                    tabSubs.classList.add('active');
                    tabSubs.style.borderBottomColor = 'var(--primary)';
                    tabSubs.style.color = 'var(--primary)';
                }
                if (typeof adminPortalUI !== 'undefined' && adminPortalUI.loadSubscriptions) {
                    adminPortalUI.loadSubscriptions();
                }
            } else if (tabName === 'orders') {
                if (ordersContent) ordersContent.style.display = 'block';
                if (tabOrders) {
                    tabOrders.classList.add('active');
                    tabOrders.style.borderBottomColor = 'var(--primary)';
                    tabOrders.style.color = 'var(--primary)';
                }
                if (typeof adminPortalUI !== 'undefined' && adminPortalUI.loadOrders) {
                    adminPortalUI.loadOrders();
                }
            }
        }

        // ============================================
        // UNIFIED DATA IMPORT SYSTEM
        // ============================================
        // ============================================
        // ENHANCED IMPORT REPORTING & FEEDBACK SYSTEM
        // ============================================
        let importReport = {
            fileName: '',
            fileType: '',
            detectedType: '',
            totalRecords: 0,
            importedRecords: 0,
            failedRecords: 0,
            errors: [],
            warnings: [],
            timestamp: null,
            data: []
        };

        // Show import status with real-time feedback
        function showImportStatus(message, type = 'info') {
            const statusDiv = document.getElementById('importStatus');
            const statusText = document.getElementById('statusText');
            if (statusDiv && statusText) {
                statusText.textContent = message;
                statusDiv.style.display = 'block';
                statusDiv.style.background = type === 'error' ? '#FFEBEE' : 
                                             type === 'warning' ? '#FFF3E0' : '#E3F2FD';
                statusDiv.style.borderLeftColor = type === 'error' ? '#F44336' : 
                                                  type === 'warning' ? '#FF9800' : '#2196F3';
            }
        }

        // Display validation errors
        function displayValidationErrors(errors) {
            const errorDiv = document.getElementById('importErrors');
            const errorList = document.getElementById('errorList');
            if (errorDiv && errorList) {
                errorList.innerHTML = errors.map(err => `<li>${err}</li>`).join('');
                errorDiv.style.display = errors.length > 0 ? 'block' : 'none';
            }
            importReport.errors = errors;
        }

        // Display data quality warnings
        function displayWarnings(warnings) {
            const warningDiv = document.getElementById('importWarnings');
            const warningList = document.getElementById('warningList');
            if (warningDiv && warningList) {
                warningList.innerHTML = warnings.map(warn => `<li>${warn}</li>`).join('');
                warningDiv.style.display = warnings.length > 0 ? 'block' : 'none';
            }
            importReport.warnings = warnings;
        }

        // Show detailed summary
        function showImportSummary(fileName, detectedType, totalRecords, importedRecords, failedRecords) {
            const summaryDiv = document.getElementById('importSummary');
            if (summaryDiv) {
                document.getElementById('summaryFile').textContent = fileName;
                document.getElementById('summaryType').textContent = detectedType;
                document.getElementById('summaryReadCount').textContent = totalRecords;
                document.getElementById('summaryImportedCount').textContent = importedRecords;
                
                if (failedRecords > 0) {
                    document.getElementById('summaryErrorsDiv').style.display = 'block';
                    document.getElementById('summaryErrorCount').textContent = failedRecords;
                } else {
                    document.getElementById('summaryErrorsDiv').style.display = 'none';
                }
                
                const now = new Date();
                const timeStr = now.toLocaleString();
                document.getElementById('summaryTimestamp').textContent = timeStr;
                
                summaryDiv.style.display = 'block';
            }

            // Update import report
            importReport.fileName = fileName;
            importReport.detectedType = detectedType;
            importReport.totalRecords = totalRecords;
            importReport.importedRecords = importedRecords;
            importReport.failedRecords = failedRecords;
            importReport.timestamp = new Date().toISOString();
        }

        // Generate downloadable report
        function downloadImportReport() {
            if (!importReport.fileName) {
                showToast('No import report available', 'warning');
                return;
            }

            const reportContent = `
EARLYBIRD IMPORT REPORT
=======================
Generated: ${new Date().toLocaleString()}

FILE INFORMATION
----------------
File Name: ${importReport.fileName}
Data Type: ${importReport.detectedType}
Import Time: ${importReport.timestamp}

IMPORT RESULTS
--------------
Total Records Read:    ${importReport.totalRecords}
Successfully Imported: ${importReport.importedRecords}
Failed Records:        ${importReport.failedRecords}
Success Rate:          ${importReport.totalRecords > 0 ? ((importReport.importedRecords / importReport.totalRecords) * 100).toFixed(1) : 0}%

VALIDATION ERRORS
-----------------
${importReport.errors.length > 0 ? importReport.errors.map((err, i) => `${i + 1}. ${err}`).join('\n') : 'None'}

DATA QUALITY WARNINGS
---------------------
${importReport.warnings.length > 0 ? importReport.warnings.map((warn, i) => `${i + 1}. ${warn}`).join('\n') : 'None'}

RECOMMENDED ACTIONS
-------------------
${importReport.failedRecords > 0 ? '1. Review the errors above and fix the data\n2. Re-download the template\n3. Re-import the corrected file' : 'No actions required. Import was successful!'}

---
For support: contact@earlybird.app
`;

            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Import_Report_${importReport.detectedType}_${new Date().getTime()}.txt`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);

            showToast('Report downloaded successfully', 'success');
        }

        // Clear import results
        function clearImportResults() {
            document.getElementById('importStatus').style.display = 'none';
            document.getElementById('importErrors').style.display = 'none';
            document.getElementById('importWarnings').style.display = 'none';
            document.getElementById('importResult').style.display = 'none';
            document.getElementById('importSummary').style.display = 'none';
            document.getElementById('importProgress').style.display = 'none';
            document.getElementById('fileStatus').style.display = 'none';
            
            // Reset file input
            const fileInput = document.getElementById('importFileInput');
            if (fileInput) fileInput.value = '';
            
            importReport = {
                fileName: '',
                fileType: '',
                detectedType: '',
                totalRecords: 0,
                importedRecords: 0,
                failedRecords: 0,
                errors: [],
                warnings: [],
                timestamp: null,
                data: []
            };
            
            showToast('Results cleared', 'info');
        }

        // ============================================
        // DOWNLOAD IMPORT TEMPLATE
        // ============================================
        function downloadImportTemplate() {
            const link = document.createElement('a');
            link.href = '../assets/EarlyBird_Import_Template.xlsx';
            link.download = 'EarlyBird_Import_Template.xlsx';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showToast('Template downloading...', 'info');
        }

        // Setup file input listener for unified import
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('importFileInput');
            if (fileInput) {
                fileInput.addEventListener('change', handleImportFileSelect);
            }
        });

        // Unified file handler for all data imports
        async function handleImportFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            const fileName = file.name;
            const fileExt = fileName.split('.').pop().toLowerCase();
            
            // Validate file format
            if (fileExt !== 'xlsx' && fileExt !== 'xls' && fileExt !== 'csv') {
                showToast('Unsupported file format. Please use Excel (.xlsx) or CSV file.', 'error');
                return;
            }
            
            // Show file selected
            document.getElementById('fileStatus').style.display = 'block';
            document.getElementById('fileName').textContent = `üìÑ ${fileName} selected`;
            
            // Show progress
            document.getElementById('importProgress').style.display = 'block';
            document.getElementById('importResult').style.display = 'none';
            clearImportResults();
            
            // Detect data type from file
            const dataType = detectDataTypeFromFileName(fileName);
            showImportStatus(`üîÑ Uploading ${fileName}...`, 'info');
            
            // Send to backend
            await uploadFileToBackend(file, dataType);
        }
        
        // Detect import type from filename or content
        function detectDataTypeFromFileName(fileName) {
            const nameLower = fileName.toLowerCase();
            
            if (nameLower.includes('customer')) return 'customers';
            if (nameLower.includes('order')) return 'orders';
            if (nameLower.includes('delivery')) return 'delivery';
            if (nameLower.includes('subscription')) return 'subscriptions';
            if (nameLower.includes('supplier')) return 'suppliers';
            
            // Default to customers
            return 'customers';
        }
        
        // Upload file to backend endpoint
        async function uploadFileToBackend(file, dataType) {
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                showImportStatus(`‚è≥ Uploading to server...`, 'info');
                
                // Get auth token (adjust based on your auth system)
                const authToken = localStorage.getItem('adminToken') || 'demo-token';
                
                // Use correct backend URL - adjust if your backend is on different host/port
                const backendUrl = `http://localhost:9001/api/admin/import/${dataType}`;
                
                const response = await fetch(backendUrl, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const result = await response.json();
                
                if (!response.ok) {
                    showImportStatus(`‚ùå Import Failed: ${result.error || 'Unknown error'}`, 'error');
                    displayValidationErrors([result.error || 'Server error']);
                    showToast('Import failed: ' + (result.error || 'Server error'), 'error');
                    return;
                }
                
                // Show results
                displayImportResults(result);
                
            } catch (error) {
                console.error('Upload error:', error);
                showImportStatus(`‚ùå Connection Error: ${error.message}`, 'error');
                displayValidationErrors([`Error: ${error.message}`]);
                showToast('Import failed: ' + error.message, 'error');
            } finally {
                document.getElementById('importProgress').style.display = 'none';
            }
        }
        
        // Display results from backend
        function displayImportResults(result) {
            const {
                import_id,
                status,
                data_type,
                file_name,
                total_records,
                imported_records,
                failed_records,
                errors,
                warnings,
                timestamp
            } = result;
            
            // Show status
            if (status === 'success') {
                showImportStatus(`‚úÖ Import Successful: ${imported_records}/${total_records} records imported`, 'success');
            } else if (status === 'partial') {
                showImportStatus(`‚ö†Ô∏è Import Partial: ${imported_records}/${total_records} records imported, ${failed_records} failed`, 'warning');
            } else {
                showImportStatus(`‚ùå Import Failed: ${failed_records} of ${total_records} records failed`, 'error');
            }
            
            // Show errors if any
            if (errors && errors.length > 0) {
                displayValidationErrors(errors);
            }
            
            // Show warnings if any
            if (warnings && warnings.length > 0) {
                displayWarnings(warnings);
            }
            
            // Show summary
            showImportSummary(file_name, data_type, total_records, imported_records, failed_records);
            
            // Show result
            const resultDiv = document.getElementById('importResult');
            if (resultDiv) {
                const successRate = total_records > 0 ? ((imported_records / total_records) * 100).toFixed(1) : 0;
                let resultHTML = '';
                
                if (status === 'success') {
                    resultHTML = `
                        <div style="background: #E8F5E9; border: 1px solid #4CAF50; padding: 12px; border-radius: 4px;">
                            <div style="color: #2E7D32; font-weight: 600; margin-bottom: 8px;">‚úÖ Import Completed Successfully!</div>
                            <div style="font-size: 12px; color: #558B2F;">
                                <div>üìä Type: <strong>${data_type}</strong></div>
                                <div>‚úì Imported: <strong>${imported_records}</strong> records</div>
                                <div>üìà Success Rate: <strong>${successRate}%</strong></div>
                                <div>ID: ${import_id}</div>
                            </div>
                        </div>
                    `;
                } else if (status === 'partial') {
                    resultHTML = `
                        <div style="background: #FFF3E0; border: 1px solid #FF9800; padding: 12px; border-radius: 4px;">
                            <div style="color: #E65100; font-weight: 600; margin-bottom: 8px;">‚ö†Ô∏è Import Completed with Issues</div>
                            <div style="font-size: 12px; color: #BF360C;">
                                <div>üìä Type: <strong>${data_type}</strong></div>
                                <div>‚úì Imported: <strong>${imported_records}</strong> records</div>
                                <div>‚ùå Failed: <strong>${failed_records}</strong> records</div>
                                <div>üìà Success Rate: <strong>${successRate}%</strong></div>
                                <div>ID: ${import_id}</div>
                            </div>
                        </div>
                    `;
                } else {
                    resultHTML = `
                        <div style="background: #FFEBEE; border: 1px solid #F44336; padding: 12px; border-radius: 4px;">
                            <div style="color: #C62828; font-weight: 600; margin-bottom: 8px;">‚ùå Import Failed</div>
                            <div style="font-size: 12px; color: #B71C1C;">
                                <div>All records failed validation. Please review errors above.</div>
                                <div>ID: ${import_id}</div>
                            </div>
                        </div>
                    `;
                }
                
                resultDiv.innerHTML = resultHTML;
                resultDiv.style.display = 'block';
            }
            
            // Show success toast
            if (status === 'success') {
                showToast(`‚úì Successfully imported ${imported_records} ${data_type} records!`, 'success');
            } else if (status === 'partial') {
                showToast(`‚ö†Ô∏è Imported ${imported_records}/${total_records} records. Review errors.`, 'warning');
            } else {
                showToast(`‚ùå Import failed. ${failed_records} records could not be imported.`, 'error');
            }
        }

        // NOTE: XLSX and CSV parsing now handled by backend
        // Frontend now sends files directly to /api/admin/import/{dataType}
        // Backend handles: file parsing, validation, data type detection, storage

        // Load sample demo data
        function loadSampleData() {
            const sampleCustomers = [
                {
                    'Customer ID': 'CUST001',
                    'Name': 'Rajesh Kumar',
                    'Email': 'rajesh@email.com',
                    'Phone': '9876543210',
                    'Area': 'Bangalore',
                    'Subscription': 'Premium Daily',
                    'Price': 500,
                    'delivery_date': '2024-01-15',
                    'Balance': 1500
                },
                {
                    'Customer ID': 'CUST002',
                    'Name': 'Priya Sharma',
                    'Email': 'priya@email.com',
                    'Phone': '9876543211',
                    'Area': 'Hyderabad',
                    'Subscription': 'Standard Weekly',
                    'Price': 300,
                    'delivery_date': '2024-01-16',
                    'Balance': 800
                },
                {
                    'Customer ID': 'CUST003',
                    'Name': 'Amit Patel',
                    'Email': 'amit@email.com',
                    'Phone': '9876543212',
                    'Area': 'Pune',
                    'Subscription': 'Premium Daily',
                    'Price': 500,
                    'delivery_date': '2024-01-17',
                    'Balance': 0
                },
                {
                    'Customer ID': 'CUST004',
                    'Name': 'Sunita Singh',
                    'Email': 'sunita@email.com',
                    'Phone': '9876543213',
                    'Area': 'Mumbai',
                    'Subscription': 'Standard Weekly',
                    'Price': 300,
                    'delivery_date': '2024-01-18',
                    'Balance': 600
                },
                {
                    'Customer ID': 'CUST005',
                    'Name': 'Vikram Reddy',
                    'Email': 'vikram@email.com',
                    'Phone': '9876543214',
                    'Area': 'Bangalore',
                    'Subscription': 'Express 3-Day',
                    'Price': 150,
                    'delivery_date': '2024-01-19',
                    'Balance': 0
                }
            ];

            const existing = JSON.parse(localStorage.getItem('customers') || '[]');
            const updated = [...existing, ...sampleCustomers];
            localStorage.setItem('customers', JSON.stringify(updated));

            showToast('‚úì Sample data loaded! 5 customers added.', 'success');
            
            // Show import success in UI
            document.getElementById('importProgress').style.display = 'block';
            document.getElementById('importResult').style.display = 'block';
            document.getElementById('rowCount').textContent = 5;
            document.getElementById('importedCount').textContent = 5;
            document.getElementById('progressBar').style.width = '100%';
            
            document.getElementById('importResult').innerHTML = `
                <div style="background: #E8F5E9; border: 1px solid #4CAF50; padding: 12px; border-radius: 4px;">
                    <div style="color: #2E7D32; font-weight: 600; margin-bottom: 8px;">‚úì Sample Data Loaded!</div>
                    <div style="font-size: 12px; color: #558B2F;">
                        <div>üìä Type: <strong>customers</strong></div>
                        <div>‚úì Imported: <strong>5</strong> sample customers</div>
                        <div>üìç Areas: Bangalore, Hyderabad, Pune, Mumbai</div>
                    </div>
                </div>
            `;
        }

        // Create adminPortalUI object with import methods
        // Note: adminPortalUI is already defined in admin-ui.js, we just need to add the import methods
        if (typeof adminPortalUI === 'undefined') {
            const adminPortalUI = {
                downloadImportTemplate: downloadImportTemplate,
                handleImportFileSelect: handleImportFileSelect,
                loadSampleData: loadSampleData
            };
        } else {
            // Add import methods to existing adminPortalUI object
            adminPortalUI.downloadImportTemplate = downloadImportTemplate;
            adminPortalUI.handleImportFileSelect = handleImportFileSelect;
            adminPortalUI.loadSampleData = loadSampleData;
        }

        // Make functions available globally as well
        window.downloadImportTemplate = downloadImportTemplate;
        window.handleImportFileSelect = handleImportFileSelect;
        window.loadSampleData = loadSampleData;
        window.showPage = showPage;

        // Set active navigation item
        function setActiveNav(pageId) {
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Add active class to selected nav item
            const activeItem = document.querySelector(`[data-page="${pageId}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
        }

        // Initialize on DOM load
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Get current user
                if (typeof EarlyBirdAuth === 'undefined') {
                    console.warn('EarlyBirdAuth not loaded');
                    return;
                }

                const currentUser = EarlyBirdAuth.getCurrentUser();
                if (currentUser.role !== 'admin' && currentUser.role !== 'marketing_staff') {
                    console.warn('Access denied. Admin/Marketing only.');
                    window.location.href = EarlyBirdAuth.getRedirectUrl(currentUser.role);
                    return;
                }

                // Display user info in header
                const userInfoEl = document.querySelector('.user-info .user-name');
                if (userInfoEl) {
                    userInfoEl.textContent = currentUser.name;
                }

                // Initialize data from localStorage
                if (localStorage.getItem('earlybird_customers')) {
                    if (!window.EarlyBirdOrders) window.EarlyBirdOrders = { state: {} };
                    window.EarlyBirdOrders.state.customers = JSON.parse(localStorage.getItem('earlybird_customers'));
                }
                if (localStorage.getItem('earlybird_orders')) {
                    if (!window.EarlyBirdOrders) window.EarlyBirdOrders = { state: {} };
                    window.EarlyBirdOrders.state.orders = JSON.parse(localStorage.getItem('earlybird_orders'));
                }

                // Initialize calendar asynchronously
                setTimeout(() => {
                    try {
                        initCalendar();
                    } catch (e) {
                        console.warn('Calendar init:', e);
                    }
                }, 50);
            } catch (error) {
                console.error('DOM initialization error:', error);
            }
        });


        // ============================================
        // Area Management UI
        // ============================================
        // Area Management UI
        // ============================================
        const areaManagementUI = {
            areas: [],

            loadAreas() {
                // Load from localStorage
                const stored = localStorage.getItem('earlybird_areas');
                this.areas = stored ? JSON.parse(stored) : this.getDefaultAreas();
                
                if (!stored) {
                    localStorage.setItem('earlybird_areas', JSON.stringify(this.areas));
                }

                this.renderGrid();
                this.updateSummary();
            }, 

            loadStaff() {
                // Get all staff wallets and calculate commissions
                const wallets = EarlyBirdWallet.state.wallets || {};
                const staffWallets = Object.values(wallets).filter(w => w.userType === 'staff');

                document.getElementById('totalStaff').textContent = staffWallets.length.toString();

                let todayEarnings = 0;
                let totalPaidOut = 0;

                staffWallets.forEach(wallet => {
                    wallet.transactions?.forEach(txn => {
                        const txnDate = txn.date?.split('T')[0];
                        const today = new Date().toISOString().split('T')[0];
                        if (txnDate === today && txn.type === 'commission') {
                            todayEarnings += Math.abs(txn.amount);
                        }
                        if (txn.type === 'withdrawal' || txn.type === 'paidout') {
                            totalPaidOut += Math.abs(txn.amount);
                        }
                    });
                });

                document.getElementById('todayEarnings').textContent = `‚Çπ${todayEarnings.toFixed(0)}`;
                document.getElementById('totalPaidOut').textContent = `‚Çπ${totalPaidOut.toFixed(0)}`;

                this.renderStaffTable(staffWallets);
            },

            renderStaffTable(staffWallets) {
                const container = document.getElementById('staffList');

                if (staffWallets.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>No staff data available</p></div>';
                    return;
                }

                let html = `
                    <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                        <thead>
                            <tr style="background: var(--light); border-bottom: 2px solid var(--border);">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Staff ID</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Role</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Balance</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Today's Earnings</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Total Earned</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                staffWallets.forEach(wallet => {
                    let todayEarnings = 0;
                    let totalEarned = 0;

                    wallet.transactions?.forEach(txn => {
                        const txnDate = txn.date?.split('T')[0];
                        const today = new Date().toISOString().split('T')[0];
                        if (txnDate === today && txn.type === 'commission') {
                            todayEarnings += Math.abs(txn.amount);
                        }
                        if (txn.type === 'commission') {
                            totalEarned += Math.abs(txn.amount);
                        }
                    });

                    html += `
                        <tr style="border-bottom: 1px solid var(--border);">
                            <td style="padding: 12px;">${wallet.userId}</td>
                            <td style="padding: 12px;">Delivery Boy</td>
                            <td style="padding: 12px; font-weight: 600;">‚Çπ${wallet.balance.toFixed(0)}</td>
                            <td style="padding: 12px;">‚Çπ${todayEarnings.toFixed(0)}</td>
                            <td style="padding: 12px;">‚Çπ${totalEarned.toFixed(0)}</td>
                            <td style="padding: 12px;">
                                <button class="btn btn-sm" style="padding: 4px 8px; font-size: 12px;" 
                                    onclick="adminPortalUI.viewStaffDetails('${wallet.userId}')">Details</button>
                            </td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                    </div>
                `;

                container.innerHTML = html;
            },

            viewStaffDetails(staffId) {
                const wallet = EarlyBirdWallet.state.wallets?.[staffId];
                if (!wallet) {
                    Toast.warning('Staff not found', 'Not Found');
                    return;
                }

                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-dialog">
                        <div class="modal-header">
                            <h2>üëî Staff Details - ${staffId}</h2>
                            <button onclick="this.closest('.modal-overlay').remove()" style="background: none; border: none; font-size: 20px; cursor: pointer;">‚úï</button>
                        </div>
                        <div class="modal-body" style="padding: 20px;">
                            <h3 style="margin-bottom: 16px;">Wallet Summary</h3>
                            <div class="stat-grid" style="margin-bottom: 20px;">
                                <div class="summary-box">
                                    <div class="summary-label">Current Balance</div>
                                    <div class="summary-value">‚Çπ${wallet.balance.toFixed(0)}</div>
                                </div>
                                <div class="summary-box">
                                    <div class="summary-label">Total Earned</div>
                                    <div class="summary-value">‚Çπ${(wallet.totalEarned || 0).toFixed(0)}</div>
                                </div>
                            </div>

                            <h3 style="margin-bottom: 12px;">Recent Transactions</h3>
                            <div style="background: var(--light); padding: 12px; border-radius: 6px; max-height: 300px; overflow-y: auto;">
                                ${(wallet.transactions || []).slice(-10).reverse().map(txn => `
                                    <div style="padding: 8px 0; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between;">
                                        <span>${txn.type}</span>
                                        <span style="font-weight: 600;">‚Çπ${txn.amount.toFixed(2)}</span>
                                    </div>
                                `).join('')}
                            </div>

                            <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" 
                                onclick="this.closest('.modal-overlay').remove()">Close</button>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);
            },

            loadSubscriptions() {
                // Load subscriptions from module
                const subscriptions = EarlyBirdSubscription?.state?.subscriptions || [];
                const statusFilter = document.getElementById('subscriptionStatusFilter')?.value || '';
                const freqFilter = document.getElementById('subscriptionFreqFilter')?.value || '';

                let filtered = subscriptions;
                if (statusFilter) {
                    filtered = filtered.filter(s => s.status === statusFilter);
                }
                if (freqFilter) {
                    filtered = filtered.filter(s => s.frequency === freqFilter);
                }

                // Calculate stats
                const active = subscriptions.filter(s => s.status === 'active').length;
                const paused = subscriptions.filter(s => s.status === 'paused').length;
                let revenue = 0;
                subscriptions.forEach(s => {
                    if (s.status === 'active') {
                        revenue += (s.price || 0);
                    }
                });

                document.getElementById('activeSubscriptions').textContent = active.toString();
                document.getElementById('pausedSubscriptions').textContent = paused.toString();
                document.getElementById('subscriptionRevenue').textContent = `‚Çπ${(revenue * 30).toFixed(0)}`;

                this.renderSubscriptionsTable(filtered);
            },

            renderSubscriptionsTable(subscriptions) {
                const container = document.getElementById('subscriptionsList');

                if (!subscriptions || subscriptions.length === 0) {
                    container.innerHTML = '<div class="empty-state" style="padding: 40px; text-align: center;"><p>No subscriptions found</p></div>';
                    return;
                }

                let html = `
                    <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                        <thead>
                            <tr style="background: var(--light); border-bottom: 2px solid var(--border);">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Subscription ID</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Customer</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Product</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Frequency</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Price</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Status</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                subscriptions.forEach(sub => {
                    const statusColor = {
                        'active': '#4CAF50',
                        'paused': '#FF9800',
                        'cancelled': '#F44336',
                        'pending': '#2196F3'
                    }[sub.status] || '#999';

                    html += `
                        <tr style="border-bottom: 1px solid var(--border);">
                            <td style="padding: 12px;">${sub.id || 'N/A'}</td>
                            <td style="padding: 12px;">${sub.customerName || 'N/A'}</td>
                            <td style="padding: 12px;">${sub.productName || sub.product || 'N/A'}</td>
                            <td style="padding: 12px;">${sub.frequency || 'N/A'}</td>
                            <td style="padding: 12px;">‚Çπ${sub.price || 0}</td>
                            <td style="padding: 12px;">
                                <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                    ${sub.status}
                                </span>
                            </td>
                            <td style="padding: 12px;">
                                <button class="btn btn-sm" style="padding: 4px 8px; font-size: 12px;" 
                                    onclick="adminPortalUI.showEditSubscriptionModal('${sub.id}')">Edit</button>
                            </td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                    </div>
                `;

                container.innerHTML = html;
            },

            showAddSubscriptionModal() {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-dialog">
                        <div class="modal-header">
                            <h2>‚ûï Add Subscription</h2>
                            <button onclick="this.closest('.modal-overlay').remove()" style="background: none; border: none; font-size: 20px; cursor: pointer;">‚úï</button>
                        </div>
                        <div class="modal-body" style="padding: 20px;">
                            <form onsubmit="event.preventDefault(); adminPortalUI.createSubscription();">
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Customer Name</label>
                                    <input type="text" id="subCustomerName" required style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Product</label>
                                    <input type="text" id="subProduct" required style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Frequency</label>
                                    <select id="subFrequency" required style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
                                        <option value="">Select frequency</option>
                                        <option value="daily">Daily</option>
                                        <option value="alternate_days">Alternate Days</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="biweekly">Bi-weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Price (‚Çπ)</label>
                                    <input type="number" id="subPrice" required min="0" step="0.01" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
                                </div>
                                <button type="submit" class="btn btn-primary" style="width: 100%;">Create Subscription</button>
                            </form>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            showEditSubscriptionModal(subId) {
                Toast.info('Edit subscription feature coming soon for: ' + subId, 'Coming Soon');
            },

            createSubscription() {
                const customerName = document.getElementById('subCustomerName').value;
                const product = document.getElementById('subProduct').value;
                const frequency = document.getElementById('subFrequency').value;
                const price = parseFloat(document.getElementById('subPrice').value);

                if (!customerName || !product || !frequency || !price) {
                    Toast.error('Please fill all fields', 'Validation');
                    return;
                }

                // Generate unique subscription ID
                const subscriptionId = 'SUB' + Date.now() + Math.random().toString(36).substr(2, 9).toUpperCase();

                if (typeof EarlyBirdSubscription !== 'undefined' && EarlyBirdSubscription.createSubscription) {
                    EarlyBirdSubscription.createSubscription({
                        id: subscriptionId,
                        customerName,
                        productName: product,
                        frequency,
                        price,
                        status: 'active'
                    });
                } else {
                    // Fallback if module not available
                    if (!window.subscriptions) window.subscriptions = [];
                    window.subscriptions.push({
                        id: subscriptionId,
                        customerName,
                        productName: product,
                        frequency,
                        price,
                        status: 'active',
                        createdAt: new Date().toISOString()
                    });
                    localStorage.setItem('earlybird_subscriptions', JSON.stringify(window.subscriptions));
                }

                Toast.success(`Subscription created! ID: ${subscriptionId}`, 'Success');
                document.querySelector('.modal-overlay')?.remove();
                this.loadSubscriptions();
            },

            // ====== CUSTOMER MANAGEMENT FUNCTIONS ======
            loadCustomers() {
                const customers = EarlyBirdOrders?.state?.customers || [];
                document.getElementById('customerCount').textContent = `${customers.length} customers`;
                this.renderCustomersGrid(customers);
            },

            searchCustomers() {
                const searchTerm = document.getElementById('customerSearchInput').value.toLowerCase();
                const customers = EarlyBirdOrders?.state?.customers || [];
                const filtered = customers.filter(c => 
                    c.name.toLowerCase().includes(searchTerm) || 
                    c.email.toLowerCase().includes(searchTerm) ||
                    c.phone.includes(searchTerm)
                );
                this.renderCustomersGrid(filtered);
            },

            renderCustomersGrid(customers) {
                const container = document.getElementById('customersList');
                
                if (!customers || customers.length === 0) {
                    container.innerHTML = '<div class="empty-state" style="padding: 40px; text-align: center;"><p>No customers found</p></div>';
                    return;
                }

                let html = `
                    <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                        <thead>
                            <tr style="background: var(--light); border-bottom: 2px solid var(--border); position: sticky; top: 0;">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Customer ID</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Name</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Email</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Phone</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Area</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Orders</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Status</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                customers.forEach((customer, idx) => {
                    const orderCount = customer.orders?.length || 0;
                    const status = customer.status || 'active';
                    const statusColor = status === 'active' ? '#4CAF50' : '#FF9800';
                    
                    html += `
                        <tr style="border-bottom: 1px solid var(--border); hover: background: var(--light);">
                            <td style="padding: 12px; font-family: monospace; color: var(--primary);">${customer.id || `CUST${idx + 1}`}</td>
                            <td style="padding: 12px; font-weight: 500;">${customer.name}</td>
                            <td style="padding: 12px; font-size: 13px;">${customer.email}</td>
                            <td style="padding: 12px; font-weight: 500;">${customer.phone}</td>
                            <td style="padding: 12px;">${customer.area || 'N/A'}</td>
                            <td style="padding: 12px; text-align: center;"><span style="background: var(--light); padding: 4px 8px; border-radius: 4px;">${orderCount}</span></td>
                            <td style="padding: 12px;">
                                <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                    ${status}
                                </span>
                            </td>
                            <td style="padding: 12px;">
                                <button class="btn btn-sm" style="padding: 4px 8px; font-size: 12px; margin-right: 4px;" 
                                    onclick="adminPortalUI.showEditCustomerModal('${customer.id || idx}')">Edit</button>
                                <button class="btn btn-sm" style="padding: 4px 8px; font-size: 12px; background: #FF6B35; color: white;" 
                                    onclick="adminPortalUI.deleteCustomer('${customer.id || idx}')">Delete</button>
                            </td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                    </div>
                `;

                container.innerHTML = html;
            },

            showAddCustomerModal() {
                const areas = areaManagementUI.getAllAreas();
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-dialog" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
                        <div class="modal-header">
                            <h2>‚ûï Add New Customer</h2>
                            <button onclick="this.closest('.modal-overlay').remove()" style="background: none; border: none; font-size: 20px; cursor: pointer;">‚úï</button>
                        </div>
                        <div class="modal-body" style="padding: 20px;">
                            <form onsubmit="event.preventDefault(); adminPortalUI.createCustomer();">
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Full Name *</label>
                                    <input type="text" id="customerName" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Email *</label>
                                    <input type="email" id="customerEmail" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Phone *</label>
                                    <input type="tel" id="customerPhone" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Address *</label>
                                    <textarea id="customerAddress" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; resize: none; height: 80px;"></textarea>
                                </div>
                                
                                <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); padding: 12px; border-radius: 6px; margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #667eea;">üìç Location Details</label>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                        <div>
                                            <label style="display: block; margin-bottom: 4px; font-size: 13px;">Latitude</label>
                                            <input type="text" id="customerLatitude" placeholder="Auto-capture" readonly style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--light);">
                                        </div>
                                        <div>
                                            <label style="display: block; margin-bottom: 4px; font-size: 13px;">Longitude</label>
                                            <input type="text" id="customerLongitude" placeholder="Auto-capture" readonly style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: var(--light);">
                                        </div>
                                    </div>
                                    <button type="button" onclick="adminPortalUI.captureLocation()" style="margin-top: 8px; width: 100%; padding: 8px; background: #2196F3; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 13px;">
                                        üìç Capture Location
                                    </button>
                                </div>

                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Area üó∫Ô∏è *</label>
                                    <select id="customerArea" required onchange="adminPortalUI.onAreaSelected()" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;">
                                        <option value="">-- Select Area --</option>
                                        ${areas.map(a => `<option value="${a.id}">${a.name}</option>`).join('')}
                                    </select>
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Sub-Area *</label>
                                    <select id="customerSubArea" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;">
                                        <option value="">-- Select Sub-Area --</option>
                                    </select>
                                </div>

                                <div style="background: linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(232, 90, 42, 0.1) 100%); padding: 12px; border-radius: 6px; margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600; color: #FF9800;">üë• Staff Assignment</label>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                        <div>
                                            <label style="display: block; margin-bottom: 4px; font-size: 13px;">üì¢ Marketed By *</label>
                                            <select id="customerMarketedBy" required style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;">
                                                <option value="">-- Select Staff --</option>
                                                <option value="Priya">Priya</option>
                                                <option value="Vikas">Vikas</option>
                                                <option value="Sarah">Sarah</option>
                                                <option value="Amit">Amit</option>
                                                <option value="Neha">Neha</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label style="display: block; margin-bottom: 4px; font-size: 13px;">üöö Delivery By *</label>
                                            <select id="customerDeliveryBy" required style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;">
                                                <option value="">-- Select Delivery Boy --</option>
                                                <option value="Raj Kumar">Raj Kumar</option>
                                                <option value="Rohan">Rohan</option>
                                                <option value="Unassigned">Unassigned</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">Create Customer</button>
                            </form>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            onAreaSelected() {
                const areaId = document.getElementById('customerArea').value;
                const subAreaSelect = document.getElementById('customerSubArea');
                const area = areaManagementUI.getAreaById(areaId);
                
                if (area && area.subAreas && area.subAreas.length > 0) {
                    subAreaSelect.innerHTML = '<option value="">-- Select Sub-Area --</option>' + 
                        area.subAreas.map(s => `<option value="${s}">${s}</option>`).join('');
                } else {
                    subAreaSelect.innerHTML = '<option value="">-- Select Sub-Area --</option>';
                }
            },

            createCustomer() {
                const name = document.getElementById('customerName').value;
                const email = document.getElementById('customerEmail').value;
                const phone = document.getElementById('customerPhone').value;
                const address = document.getElementById('customerAddress').value;
                const latitude = document.getElementById('customerLatitude').value;
                const longitude = document.getElementById('customerLongitude').value;
                const areaId = document.getElementById('customerArea').value;
                const subArea = document.getElementById('customerSubArea').value;
                const marketedBy = document.getElementById('customerMarketedBy').value;
                const deliveryBy = document.getElementById('customerDeliveryBy').value;

                if (!name || !email || !phone || !address || !areaId || !subArea || !marketedBy || !deliveryBy) {
                    Toast.error('Please fill all required fields', 'Validation Required');
                    return;
                }

                const area = areaManagementUI.getAreaById(areaId);
                const customerId = 'CUST' + Date.now();
                const newCustomer = {
                    id: customerId,
                    name,
                    email,
                    phone,
                    address,
                    latitude: latitude || '',
                    longitude: longitude || '',
                    areaId: areaId,
                    areaName: area ? area.name : '',
                    subArea: subArea,
                    marketedBy: marketedBy,
                    deliveryBy: deliveryBy,
                    status: 'active',
                    createdAt: new Date().toISOString(),
                    orders: []
                };

                // Initialize customer data if not exists
                if (!EarlyBirdOrders) window.EarlyBirdOrders = { state: { customers: [] } };
                if (!EarlyBirdOrders.state) EarlyBirdOrders.state = { customers: [] };
                if (!EarlyBirdOrders.state.customers) EarlyBirdOrders.state.customers = [];

                EarlyBirdOrders.state.customers.push(newCustomer);
                localStorage.setItem('earlybird_customers', JSON.stringify(EarlyBirdOrders.state.customers));

                // Close modal
                document.querySelector('.modal-overlay')?.remove();
                
                // Show post-creation options
                adminPortalUI.showPostCustomerCreationModal(newCustomer);
            },

            captureLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const lat = position.coords.latitude.toFixed(6);
                            const lng = position.coords.longitude.toFixed(6);
                            document.getElementById('customerLatitude').value = lat;
                            document.getElementById('customerLongitude').value = lng;
                            Toast.success(`Location captured at ${lat}, ${lng}`, 'GPS Captured');
                        },
                        (error) => {
                            Toast.error('Unable to capture location: ' + error.message, 'Location Error');
                        }
                    );
                } else {
                    Toast.warning('Geolocation not supported by your browser', 'Browser Support');
                }
            },

            showPostCustomerCreationModal(customer) {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-dialog" style="max-width: 500px;">
                        <div class="modal-header">
                            <h2>üéâ Customer Created Successfully!</h2>
                            <button onclick="this.closest('.modal-overlay').remove()" style="background: none; border: none; font-size: 20px; cursor: pointer;">‚úï</button>
                        </div>
                        <div class="modal-body" style="padding: 20px;">
                            <div style="background: var(--light); padding: 16px; border-radius: 8px; margin-bottom: 20px;">
                                <div style="font-size: 14px; margin-bottom: 8px;"><strong>‚úì ${customer.name}</strong></div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 6px;">üì± ${customer.phone}</div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 6px;">üó∫Ô∏è ${customer.areaName} / ${customer.subArea}</div>
                                <div style="font-size: 12px; color: var(--text-secondary);">üë§ ${customer.marketedBy} | üöö ${customer.deliveryBy}</div>
                            </div>

                            <h3 style="margin-bottom: 16px; color: #667eea;">What would you like to do next?</h3>
                            
                            <div style="display: grid; gap: 12px;">
                                <button onclick="adminPortalUI.goToOrderTrailModal('${customer.id}', '${customer.name}')" style="padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; text-align: left;">
                                    <div>üì¶ Create Order Trail</div>
                                    <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">Add one-time or immediate orders</div>
                                </button>
                                
                                <button onclick="adminPortalUI.goToSubscriptionModal('${customer.id}', '${customer.name}')" style="padding: 14px; background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px; text-align: left;">
                                    <div>üîÑ Create Subscription</div>
                                    <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">Set up recurring daily/weekly orders</div>
                                </button>
                                
                                <button onclick="(() => { document.querySelector('.modal-overlay').remove(); adminPortalUI.loadCustomers(); })()" style="padding: 14px; background: var(--light); color: var(--text); border: 1px solid var(--border); border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 14px;">
                                    ‚úì Done - View Customer List
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            goToOrderTrailModal(customerId, customerName) {
                // Close current modal
                document.querySelector('.modal-overlay')?.remove();
                
                // Show order creation modal
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-dialog" style="max-width: 500px;">
                        <div class="modal-header">
                            <h2>üì¶ Create Order for ${customerName}</h2>
                            <button onclick="this.closest('.modal-overlay').remove()" style="background: none; border: none; font-size: 20px; cursor: pointer;">‚úï</button>
                        </div>
                        <div class="modal-body" style="padding: 20px;">
                            <form onsubmit="event.preventDefault(); adminPortalUI.createOrderTrail('${customerId}');">
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Product Name *</label>
                                    <select id="orderProduct" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                        <option value="">-- Select Product --</option>
                                        ${adminPortalUI.getProductOptions()}
                                    </select>
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Quantity *</label>
                                    <input type="number" id="orderQuantity" required min="1" value="1" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Price per Unit (‚Çπ) *</label>
                                    <input type="number" id="orderPrice" required min="0" step="0.01" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Delivery Date *</label>
                                    <input type="date" id="orderDate" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Payment Status</label>
                                    <select id="orderPaymentStatus" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                        <option value="pending">Pending</option>
                                        <option value="paid">Paid</option>
                                        <option value="partial">Partial</option>
                                    </select>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                    <button type="submit" class="btn btn-primary">‚ûï Create Order</button>
                                    <button type="button" onclick="this.closest('.modal-overlay').remove(); adminPortalUI.loadCustomers();" class="btn btn-outline">Skip</button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            createOrderTrail(customerId) {
                const product = document.getElementById('orderProduct').value;
                const quantity = parseInt(document.getElementById('orderQuantity').value);
                const price = parseFloat(document.getElementById('orderPrice').value);
                const deliveryDate = document.getElementById('orderDate').value;
                const paymentStatus = document.getElementById('orderPaymentStatus')?.value || 'pending';

                const customer = EarlyBirdOrders.state.customers.find(c => c.id === customerId);
                if (!customer) {
                    Toast.warning('Customer not found', 'Not Found');
                    return;
                }

                const orderId = 'ORD' + Date.now();
                const newOrder = {
                    id: orderId,
                    customerId: customerId,
                    customerName: customer.name,
                    customerPhone: customer.phone,
                    product: product,
                    quantity: quantity,
                    price: price,
                    total: quantity * price,
                    deliveryDate: deliveryDate,
                    paymentStatus: paymentStatus,
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };

                if (!EarlyBirdOrders.state.orders) EarlyBirdOrders.state.orders = [];
                EarlyBirdOrders.state.orders.push(newOrder);
                localStorage.setItem('earlybird_orders', JSON.stringify(EarlyBirdOrders.state.orders));

                Toast.success(`Order created! ${quantity}x ${product} - ‚Çπ${newOrder.total}`, 'Order Created');
                document.querySelector('.modal-overlay')?.remove();
                adminPortalUI.loadCustomers();
            },

            goToSubscriptionModal(customerId, customerName) {
                // Close current modal
                document.querySelector('.modal-overlay')?.remove();
                
                // Show subscription creation modal
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-dialog" style="max-width: 500px;">
                        <div class="modal-header">
                            <h2>üîÑ Create Subscription for ${customerName}</h2>
                            <button onclick="this.closest('.modal-overlay').remove()" style="background: none; border: none; font-size: 20px; cursor: pointer;">‚úï</button>
                        </div>
                        <div class="modal-body" style="padding: 20px;">
                            <form onsubmit="event.preventDefault(); adminPortalUI.createSubscription('${customerId}');">
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Product Name *</label>
                                    <select id="subProduct" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                        <option value="">-- Select Product --</option>
                                        ${adminPortalUI.getProductOptions()}
                                    </select>
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Frequency *</label>
                                    <select id="subFrequency" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                        <option value="">-- Select Frequency --</option>
                                        <option value="daily">Daily</option>
                                        <option value="alternate">Alternate Days</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="biweekly">Bi-weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Quantity *</label>
                                    <input type="number" id="subQuantity" required min="1" value="1" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Price per Unit (‚Çπ) *</label>
                                    <input type="number" id="subPrice" required min="0" step="0.01" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                                    <button type="submit" class="btn btn-primary">üîÑ Create Subscription</button>
                                    <button type="button" onclick="this.closest('.modal-overlay').remove(); adminPortalUI.loadCustomers();" class="btn btn-outline">Skip</button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            createSubscription(customerId) {
                const product = document.getElementById('subProduct').value;
                const frequency = document.getElementById('subFrequency').value;
                const quantity = parseInt(document.getElementById('subQuantity').value);
                const price = parseFloat(document.getElementById('subPrice').value);

                const customer = EarlyBirdOrders.state.customers.find(c => c.id === customerId);
                if (!customer) {
                    Toast.warning('Customer not found', 'Not Found');
                    return;
                }

                const subscriptionId = 'SUB' + Date.now() + Math.random().toString(36).substr(2, 9).toUpperCase();
                const newSubscription = {
                    id: subscriptionId,
                    customerId: customerId,
                    customerName: customer.name,
                    product: product,
                    frequency: frequency,
                    quantity: quantity,
                    price: price,
                    totalPerDelivery: quantity * price,
                    status: 'active',
                    createdAt: new Date().toISOString()
                };

                if (!EarlyBirdOrders.state.subscriptions) EarlyBirdOrders.state.subscriptions = [];
                EarlyBirdOrders.state.subscriptions.push(newSubscription);
                localStorage.setItem('earlybird_subscriptions', JSON.stringify(EarlyBirdOrders.state.subscriptions));

                Toast.success(`Subscription created! ID: ${subscriptionId} - ${frequency} ${product}`, 'Subscription Created');
                document.querySelector('.modal-overlay')?.remove();
                adminPortalUI.loadCustomers();
            },

            showEditCustomerModal(customerId) {
                Toast.info('Edit customer feature: ' + customerId, 'Feature');
            },

            deleteCustomer(customerId) {
                if (!confirm('Are you sure you want to delete this customer?')) return;
                
                if (EarlyBirdOrders?.state?.customers) {
                    EarlyBirdOrders.state.customers = EarlyBirdOrders.state.customers.filter(c => c.id !== customerId);
                    localStorage.setItem('earlybird_customers', JSON.stringify(EarlyBirdOrders.state.customers));
                    adminPortalUI.loadCustomers();
                }
            },

            // ====== ORDER MANAGEMENT FUNCTIONS ======
            showCreateOrderModal() {
                const customers = EarlyBirdOrders?.state?.customers || [];
                
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-dialog" style="max-width: 600px;">
                        <div class="modal-header">
                            <h2>üì¶ Create New Order</h2>
                            <button onclick="this.closest('.modal-overlay').remove()" style="background: none; border: none; font-size: 20px; cursor: pointer;">‚úï</button>
                        </div>
                        <div class="modal-body" style="padding: 20px;">
                            <form onsubmit="event.preventDefault(); adminPortalUI.createOrder();">
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Select Customer *</label>
                                    <select id="orderCustomerId" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                        <option value="">-- Select Customer --</option>
                                        ${customers.map(c => `<option value="${c.id}">${c.name} (${c.phone})</option>`).join('')}
                                    </select>
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Product Name *</label>
                                    <select id="orderProduct" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                        <option value="">-- Select Product --</option>
                                        ${adminPortalUI.getProductOptions()}
                                    </select>
                                </div>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 6px; font-weight: 600;">Quantity *</label>
                                        <input type="number" id="orderQuantity" required min="1" value="1" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                    </div>
                                    <div>
                                        <label style="display: block; margin-bottom: 6px; font-weight: 600;">Price (‚Çπ) *</label>
                                        <input type="number" id="orderPrice" required min="0" step="0.01" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                    </div>
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Delivery Date *</label>
                                    <input type="date" id="orderDate" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                </div>
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Payment Status</label>
                                    <select id="orderPaymentStatus" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                        <option value="pending">Pending</option>
                                        <option value="paid">Paid</option>
                                        <option value="partial">Partial</option>
                                    </select>
                                </div>
                                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px;">Create Order</button>
                            </form>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            createOrder() {
                const customerId = document.getElementById('orderCustomerId').value;
                const product = document.getElementById('orderProduct').value;
                const quantity = parseInt(document.getElementById('orderQuantity').value);
                const price = parseFloat(document.getElementById('orderPrice').value);
                const date = document.getElementById('orderDate').value;
                const paymentStatus = document.getElementById('orderPaymentStatus').value;

                if (!customerId || !product || !quantity || !price || !date) {
                    Toast.error('Please fill all required fields', 'Validation Required');
                    return;
                }

                const orderId = 'ORD' + Date.now();
                const customer = EarlyBirdOrders?.state?.customers?.find(c => c.id === customerId);

                if (!customer) {
                    Toast.warning('Customer not found', 'Not Found');
                    return;
                }

                const newOrder = {
                    id: orderId,
                    customerId,
                    customerName: customer.name,
                    customerPhone: customer.phone,
                    product,
                    quantity,
                    price,
                    total: quantity * price,
                    deliveryDate: date,
                    paymentStatus: paymentStatus,
                    status: 'pending',
                    createdAt: new Date().toISOString(),
                    items: [{ productName: product, quantity, price }]
                };

                if (!EarlyBirdOrders.state.orders) EarlyBirdOrders.state.orders = [];
                EarlyBirdOrders.state.orders.push(newOrder);
                localStorage.setItem('earlybird_orders', JSON.stringify(EarlyBirdOrders.state.orders));

                Toast.success(`Order ${orderId} created for ${customer.name} - ‚Çπ${newOrder.total}`, 'Order Created');
                document.querySelector('.modal-overlay')?.remove();
                adminPortalUI.loadOrders();
            },

            loadOrders() {
                const orders = EarlyBirdOrders?.state?.orders || [];
                const statusFilter = document.getElementById('orderStatusFilter')?.value || '';
                const dateFilter = document.getElementById('orderDateFilter')?.value || '';

                let filtered = orders;
                if (statusFilter) {
                    filtered = filtered.filter(o => o.status === statusFilter);
                }
                if (dateFilter) {
                    filtered = filtered.filter(o => o.deliveryDate === dateFilter);
                }

                document.getElementById('orderCount').textContent = `${filtered.length} of ${orders.length} orders`;
                this.renderOrdersTable(filtered);
            },

            renderOrdersTable(orders) {
                const container = document.getElementById('ordersList');

                if (!orders || orders.length === 0) {
                    container.innerHTML = '<div class="empty-state" style="padding: 40px; text-align: center;"><p>No orders found</p></div>';
                    return;
                }

                let html = `
                    <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                        <thead>
                            <tr style="background: var(--light); border-bottom: 2px solid var(--border); position: sticky; top: 0;">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Order ID</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Customer</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Product</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Qty</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Total</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Payment</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Status</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                orders.forEach(order => {
                    const statusColor = {
                        'pending': '#FF9800',
                        'assigned': '#2196F3',
                        'delivered': '#4CAF50',
                        'failed': '#F44336'
                    }[order.status] || '#999';

                    const paymentColor = {
                        'pending': '#FF9800',
                        'paid': '#4CAF50',
                        'partial': '#2196F3'
                    }[order.paymentStatus] || '#999';

                    html += `
                        <tr style="border-bottom: 1px solid var(--border);">
                            <td style="padding: 12px; font-family: monospace; color: var(--primary);">${order.id}</td>
                            <td style="padding: 12px; font-weight: 500;">${order.customerName}</td>
                            <td style="padding: 12px;">${order.product}</td>
                            <td style="padding: 12px; text-align: center;">${order.quantity}</td>
                            <td style="padding: 12px; font-weight: 600;">‚Çπ${order.total.toFixed(2)}</td>
                            <td style="padding: 12px;">
                                <span style="background: ${paymentColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                    ${order.paymentStatus}
                                </span>
                            </td>
                            <td style="padding: 12px;">
                                <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                                    ${order.status}
                                </span>
                            </td>
                            <td style="padding: 12px;">
                                <button class="btn btn-sm" style="padding: 4px 8px; font-size: 12px; margin-right: 4px;" 
                                    onclick="adminPortalUI.showUpdatePaymentStatusModal('${order.id}', '${order.paymentStatus}')">Pay</button>
                                <button class="btn btn-sm" style="padding: 4px 8px; font-size: 12px; margin-right: 4px;" 
                                    onclick="adminPortalUI.sendBill('${order.id}')">Bill</button>
                            </td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                    </div>
                `;

                container.innerHTML = html;
            },

            showUpdatePaymentStatusModal(orderId, currentStatus) {
                const order = EarlyBirdOrders?.state?.orders?.find(o => o.id === orderId);
                if (!order) return;

                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-dialog" style="max-width: 400px;">
                        <div class="modal-header">
                            <h2>üí≥ Update Payment Status</h2>
                            <button onclick="this.closest('.modal-overlay').remove()" style="background: none; border: none; font-size: 20px; cursor: pointer;">‚úï</button>
                        </div>
                        <div class="modal-body" style="padding: 20px;">
                            <div style="margin-bottom: 16px; padding: 12px; background: var(--light); border-radius: 6px;">
                                <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 4px;">Order ID</div>
                                <div style="font-weight: 600; font-size: 16px;">${orderId}</div>
                                <div style="font-size: 12px; color: var(--text-secondary); margin-top: 8px; margin-bottom: 4px;">Amount</div>
                                <div style="font-weight: 600; font-size: 16px;">‚Çπ${order.total.toFixed(2)}</div>
                            </div>
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 6px; font-weight: 600;">Payment Status *</label>
                                <select id="paymentStatusSelect" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px;">
                                    <option value="">-- Select Payment Status --</option>
                                    <option value="pending" ${currentStatus === 'pending' ? 'selected' : ''}>Pending</option>
                                    <option value="partial" ${currentStatus === 'partial' ? 'selected' : ''}>Partial</option>
                                    <option value="paid" ${currentStatus === 'paid' ? 'selected' : ''}>Paid</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" style="width: 100%; padding: 12px;" onclick="
                                const status = document.getElementById('paymentStatusSelect').value;
                                if (!status) { Toast.error('Please select a payment status', 'Required'); return; }
                                adminPortalUI.confirmPaymentUpdate('${orderId}', status);
                                this.closest('.modal-overlay').remove();
                            ">‚úì Update Payment Status</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            confirmPaymentUpdate(orderId, status) {
                const order = EarlyBirdOrders?.state?.orders?.find(o => o.id === orderId);
                if (order) {
                    order.paymentStatus = status;
                    localStorage.setItem('earlybird_orders', JSON.stringify(EarlyBirdOrders.state.orders));
                    Toast.success(`Payment status updated to "${status}"`, 'Payment Updated');
                    adminPortalUI.loadOrders();
                }
            },

            sendBill(orderId) {
                const order = EarlyBirdOrders?.state?.orders?.find(o => o.id === orderId);
                if (!order) return;

                const billContent = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë          EARLYBIRD DELIVERY             ‚ïë
‚ïë           INVOICE / BILL                ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

Order ID: ${order.id}
Date: ${new Date().toLocaleDateString()}
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

Customer: ${order.customerName}
Phone: ${order.customerPhone}

ITEMS:
${order.product} x${order.quantity}  ‚Çπ${(order.price * order.quantity).toFixed(2)}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Subtotal:  ‚Çπ${order.total.toFixed(2)}
Tax (0%):  ‚Çπ0.00
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
TOTAL:     ‚Çπ${order.total.toFixed(2)}

Payment Status: ${order.paymentStatus.toUpperCase()}
Delivery Date: ${order.deliveryDate}

Thank you for your business!
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
                `;

                Toast.info('Bill generated - Check console or copy from notification', 'Bill Generated');
                
                // Copy to clipboard
                navigator.clipboard.writeText(billContent).then(() => {
                    console.log('Bill copied to clipboard');
                }).catch(err => {
                    console.log('Copy failed:', err);
                });
            },

            // ====== BILLING & INVOICES FUNCTIONS ======
            loadBillingView() {
                const orders = EarlyBirdOrders?.state?.orders || [];
                const statusFilter = document.getElementById('billingStatusFilter')?.value || '';

                let filtered = orders;
                if (statusFilter) {
                    filtered = filtered.filter(o => o.paymentStatus === statusFilter);
                }

                this.renderBillingGrid(filtered);
            },

            searchBilling() {
                const searchTerm = document.getElementById('billingSearchInput').value.toLowerCase();
                const orders = EarlyBirdOrders?.state?.orders || [];
                const filtered = orders.filter(o => 
                    o.customerName.toLowerCase().includes(searchTerm) || 
                    o.id.toLowerCase().includes(searchTerm) ||
                    o.product.toLowerCase().includes(searchTerm)
                );
                this.renderBillingGrid(filtered);
            },

            renderBillingGrid(orders) {
                const container = document.getElementById('billingGrid');

                if (!orders || orders.length === 0) {
                    container.innerHTML = '<div class="empty-state" style="padding: 40px; text-align: center;"><p>No billing records found</p></div>';
                    return;
                }

                // Calculate totals
                let totalAmount = 0;
                let totalPending = 0;
                let totalPaid = 0;
                let totalPartial = 0;

                orders.forEach(o => {
                    totalAmount += o.total;
                    if (o.paymentStatus === 'pending') totalPending += o.total;
                    else if (o.paymentStatus === 'paid') totalPaid += o.total;
                    else if (o.paymentStatus === 'partial') totalPartial += o.total;
                });

                let html = `
                    <div style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 12px;">üí∞ Billing Summary</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 16px; border-radius: 8px;">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">Total Billing Amount</div>
                                <div style="font-size: 24px; font-weight: 700;">‚Çπ${totalAmount.toFixed(2)}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 16px; border-radius: 8px;">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">Pending Payment</div>
                                <div style="font-size: 24px; font-weight: 700;">‚Çπ${totalPending.toFixed(2)}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 16px; border-radius: 8px;">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">Partial Payment</div>
                                <div style="font-size: 24px; font-weight: 700;">‚Çπ${totalPartial.toFixed(2)}</div>
                            </div>
                            <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; padding: 16px; border-radius: 8px;">
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">Paid Amount</div>
                                <div style="font-size: 24px; font-weight: 700;">‚Çπ${totalPaid.toFixed(2)}</div>
                            </div>
                        </div>
                    </div>

                    <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                        <thead>
                            <tr style="background: var(--light); border-bottom: 2px solid var(--border); position: sticky; top: 0;">
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Invoice #</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Customer</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Product</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Qty</th>
                                <th style="padding: 12px; text-align: right; font-weight: 600;">Amount</th>
                                <th style="padding: 12px; text-align: left; font-weight: 600;">Due Date</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600;">Status</th>
                                <th style="padding: 12px; text-align: center; font-weight: 600;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                orders.forEach(order => {
                    const paymentColor = {
                        'pending': '#FF9800',
                        'paid': '#4CAF50',
                        'partial': '#2196F3'
                    }[order.paymentStatus] || '#999';

                    html += `
                        <tr style="border-bottom: 1px solid var(--border); background: ${order.paymentStatus === 'pending' ? 'rgba(255, 152, 0, 0.05)' : 'transparent'}">
                            <td style="padding: 12px; font-family: monospace; font-weight: 600; color: var(--primary);">${order.id}</td>
                            <td style="padding: 12px; font-weight: 500;">${order.customerName}</td>
                            <td style="padding: 12px;">${order.product}</td>
                            <td style="padding: 12px; text-align: center;">${order.quantity}</td>
                            <td style="padding: 12px; text-align: right; font-weight: 600;">‚Çπ${order.total.toFixed(2)}</td>
                            <td style="padding: 12px; font-size: 12px;">${order.deliveryDate}</td>
                            <td style="padding: 12px; text-align: center;">
                                <span style="background: ${paymentColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">
                                    ${order.paymentStatus.toUpperCase()}
                                </span>
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                <button class="btn btn-sm" style="padding: 4px 8px; font-size: 11px; margin-right: 4px;" 
                                    onclick="adminPortalUI.updateOrderPaymentStatus('${order.id}')">üí≥ Pay</button>
                                <button class="btn btn-sm" style="padding: 4px 8px; font-size: 11px;" 
                                    onclick="adminPortalUI.sendBill('${order.id}')">üìÑ Bill</button>
                            </td>
                        </tr>
                    `;
                });

                html += `
                        </tbody>
                    </table>
                    </div>
                `;

                container.innerHTML = html;
            },

            generateSupplierOrders(dateStr) {
                if (!dateStr) {
                    EarlyBirdUtils.showToast('Please select a date first', 'warning');
                    return;
                }
                
                if (typeof EarlyBirdDemandForecast === 'undefined') {
                    EarlyBirdUtils.showToast('Demand forecast module not loaded', 'error');
                    return;
                }
                
                try {
                    // Get all orders for the selected date
                    const orders = typeof EarlyBirdOrders !== 'undefined' ? 
                        EarlyBirdOrders.getOrdersForDate(dateStr) : [];
                    
                    if (orders.length === 0) {
                        EarlyBirdUtils.showToast('No orders found for this date', 'info');
                        return;
                    }
                    
                    // Generate demand forecast
                    const forecast = new EarlyBirdDemandForecast();
                    const aggregated = forecast.aggregateDemand(orders, 1);
                    
                    if (Object.keys(aggregated).length === 0) {
                        EarlyBirdUtils.showToast('No supplier demand found', 'info');
                        return;
                    }
                    
                    // Generate supplier orders
                    let ordersGenerated = 0;
                    Object.entries(aggregated).forEach(([supplierId, forecasts]) => {
                        if (forecasts.length > 0) {
                            const dailyForecast = forecasts[0];
                            const po = forecast.generatePurchaseOrder(supplierId, [dailyForecast], {
                                quantity: 'stock_adjusted',
                                safetyStockDays: 2
                            });
                            
                            // Also create in supplier system
                            if (typeof EarlyBirdSupplier !== 'undefined') {
                                EarlyBirdSupplier.generateSupplierOrder(supplierId, [dailyForecast]);
                            }
                            
                            ordersGenerated++;
                        }
                    });
                    
                    EarlyBirdUtils.showToast(`‚úÖ Generated ${ordersGenerated} supplier order(s) for ${dateStr}`, 'success');
                    
                    // Refresh calendar to show new supplier orders
                    if (typeof EarlyBirdCalendar !== 'undefined') {
                        EarlyBirdCalendar.renderDateDetails();
                    }
                } catch (error) {
                    console.error('Error generating supplier orders:', error);
                    EarlyBirdUtils.showToast('Error generating supplier orders: ' + error.message, 'error');
                }
            },
            
            loadFinancials() {
                const wallets = EarlyBirdWallet.state.wallets || {};
                const deliveries = EarlyBirdDelivery.state.deliveries || [];

                let totalRevenue = 0;
                let staffCommissions = 0;
                let customerWalletBalance = 0;

                // Calculate totals
                Object.values(wallets).forEach(wallet => {
                    if (wallet.userType === 'customer') {
                        customerWalletBalance += wallet.balance;
                    } else if (wallet.userType === 'staff') {
                        wallet.transactions?.forEach(txn => {
                            if (txn.type === 'commission') {
                                staffCommissions += Math.abs(txn.amount);
                            }
                        });
                    }
                });

                deliveries.forEach(delivery => {
                    if (delivery.status === 'delivered') {
                        totalRevenue += delivery.currentTotal;
                    }
                });

                const netProfit = totalRevenue - staffCommissions - customerWalletBalance;

                document.getElementById('totalRevenue').textContent = `‚Çπ${totalRevenue.toFixed(0)}`;
                document.getElementById('staffCommissions').textContent = `‚Çπ${staffCommissions.toFixed(0)}`;
                document.getElementById('customerWalletBalance').textContent = `‚Çπ${customerWalletBalance.toFixed(0)}`;
                document.getElementById('netProfit').textContent = `‚Çπ${netProfit.toFixed(0)}`;

                this.renderFinancialReport(totalRevenue, staffCommissions, customerWalletBalance, netProfit);
            },

            renderFinancialReport(revenue, commissions, walletBalance, profit) {
                const container = document.getElementById('financialReport');

                const breakdown = [
                    { label: 'Gross Revenue', value: revenue, color: '#4CAF50' },
                    { label: 'Staff Commissions (Out)', value: -commissions, color: '#FF9800' },
                    { label: 'Customer Wallet Balance', value: -walletBalance, color: '#2196F3' },
                    { label: 'Net Profit', value: profit, color: '#9C27B0' }
                ];

                let html = `
                    <div style="display: grid; gap: 12px;">
                `;

                breakdown.forEach(item => {
                    html += `
                        <div style="display: flex; justify-content: space-between; padding: 12px; background: var(--light); border-left: 4px solid ${item.color}; border-radius: 6px;">
                            <span style="font-weight: 600;">${item.label}</span>
                            <span style="font-weight: 600; color: ${item.value < 0 ? '#F44336' : '#4CAF50'};">‚Çπ${item.value.toFixed(0)}</span>
                        </div>
                    `;
                });

                html += `
                    </div>

                    <div style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px;">
                        <div style="font-size: 12px; opacity: 0.9; margin-bottom: 4px;">System Health</div>
                        <div style="font-size: 24px; font-weight: 700;">‚úì Healthy</div>
                        <div style="font-size: 12px; opacity: 0.8; margin-top: 8px;">All financial metrics within normal range</div>
                    </div>
                `;

                container.innerHTML = html;
            },

            // ===== AREA MANAGEMENT METHODS =====

            getDefaultAreas() {
                return [
                    {
                        id: 'area_001',
                        name: 'Bangalore',
                        subAreas: ['Koramangala', 'Whitefield', 'Indiranagar', 'BTM Layout', 'Jayanagar'],
                        assignedDeliveryBoys: ['Raj Kumar', 'Rohan'],
                        status: 'active'
                    },
                    {
                        id: 'area_002',
                        name: 'Hyderabad',
                        subAreas: ['KPHB', 'Miyapur', 'Madhapur', 'Kondapur'],
                        assignedDeliveryBoys: ['Rohan'],
                        status: 'active'
                    },
                    {
                        id: 'area_003',
                        name: 'Pune',
                        subAreas: ['Hinjewadi', 'Kothrud', 'Viman Nagar'],
                        assignedDeliveryBoys: ['Raj Kumar'],
                        status: 'active'
                    },
                    {
                        id: 'area_004',
                        name: 'Mumbai',
                        subAreas: ['Powai', 'Mulund', 'Andheri'],
                        assignedDeliveryBoys: [],
                        status: 'inactive'
                    }
                ];
            },

            getAllAreas() {
                return this.areas || [];
            },

            getAreaById(areaId) {
                return this.areas.find(a => a.id === areaId);
            },

            showAddAreaModal() {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-dialog" style="max-width: 600px;">
                        <div class="modal-header">
                            <h2>‚ûï Add New Area</h2>
                            <button onclick="this.closest('.modal-overlay').remove()" style="background: none; border: none; font-size: 20px; cursor: pointer;">‚úï</button>
                        </div>
                        <div class="modal-body" style="padding: 20px;">
                            <form onsubmit="event.preventDefault(); areaManagementUI.createArea();">
                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Main Area Name *</label>
                                    <input type="text" id="areaName" placeholder="e.g., Bangalore" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;">
                                </div>

                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Sub-Area Name *</label>
                                    <input type="text" id="subAreaName" placeholder="e.g., Koramangala" required style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;">
                                    <small style="color: var(--text-secondary); margin-top: 4px; display: block;">üí° Tip: Enter one sub-area. You can add more from the grid.</small>
                                </div>

                                <div class="form-group" style="margin-bottom: 16px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">Status</label>
                                    <select id="areaStatus" style="width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;">
                                        <option value="active">Active</option>
                                        <option value="inactive">Inactive</option>
                                    </select>
                                </div>

                                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 12px; font-weight: 600;">Create Area</button>
                            </form>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            createArea() {
                const areaName = document.getElementById('areaName').value.trim();
                const subAreaName = document.getElementById('subAreaName').value.trim();
                const status = document.getElementById('areaStatus').value;

                if (!areaName || !subAreaName) {
                    Toast.error('Please fill all required fields', 'Validation Required');
                    return;
                }

                // Check if area with same name exists
                let existingArea = this.areas.find(a => a.name.toLowerCase() === areaName.toLowerCase());
                
                if (existingArea) {
                    // Add sub-area to existing area
                    if (!existingArea.subAreas.includes(subAreaName)) {
                        existingArea.subAreas.push(subAreaName);
                        Toast.success(`Added "${subAreaName}" to "${areaName}"`, 'Sub-Area Added');
                    } else {
                        Toast.warning(`"${subAreaName}" already exists in "${areaName}"`, 'Duplicate Sub-Area');
                        return;
                    }
                } else {
                    // Create new area
                    const newArea = {
                        id: 'area_' + Math.random().toString(36).substr(2, 9),
                        name: areaName,
                        subAreas: [subAreaName],
                        assignedDeliveryBoys: [],
                        status: status
                    };
                    this.areas.push(newArea);
                    Toast.success(`Area "${areaName}" created successfully`, 'Area Created');
                }

                // Save to localStorage
                localStorage.setItem('earlybird_areas', JSON.stringify(this.areas));

                // Close modal and refresh
                document.querySelector('.modal-overlay').remove();
                this.loadAreas();
            },

            renderGrid() {
                const tbody = document.getElementById('areasTableBody');
                
                if (!this.areas || this.areas.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="padding: 30px; text-align: center; color: var(--text-secondary);">No areas found. Create your first area!</td></tr>';
                    return;
                }

                let html = '';
                this.areas.forEach(area => {
                    const deliveryBoysList = area.assignedDeliveryBoys && area.assignedDeliveryBoys.length > 0 
                        ? area.assignedDeliveryBoys.join(', ') 
                        : '‚Äî';
                    
                    const statusColor = area.status === 'active' ? '#4CAF50' : '#FF9800';
                    const statusText = area.status === 'active' ? 'Active' : 'Inactive';

                    html += `
                        <tr style="border-bottom: 1px solid var(--border); hover: background: var(--light);">
                            <td style="padding: 12px; font-weight: 600; color: #667eea;">${area.name}</td>
                            <td style="padding: 12px;">${area.subAreas.join(', ')}</td>
                            <td style="padding: 12px;">${deliveryBoysList}</td>
                            <td style="padding: 12px;">
                                <span style="background: ${statusColor}20; color: ${statusColor}; padding: 4px 8px; border-radius: 12px; font-weight: 600; font-size: 12px;">
                                    ${statusText}
                                </span>
                            </td>
                            <td style="padding: 12px; text-align: center;">
                                <button onclick="areaManagementUI.editArea('${area.id}')" 
                                    style="padding: 4px 8px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600; margin-right: 4px;">
                                    ‚úèÔ∏è Edit
                                </button>
                                <button onclick="areaManagementUI.deleteArea('${area.id}')" 
                                    style="padding: 4px 8px; background: #F44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600;">
                                    üóëÔ∏è Delete
                                </button>
                            </td>
                        </tr>
                    `;
                });

                tbody.innerHTML = html;
            },

            updateSummary() {
                const totalAreas = this.areas.length;
                let totalSubAreas = 0;
                let totalDeliveryBoys = new Set();

                this.areas.forEach(area => {
                    totalSubAreas += area.subAreas.length;
                    (area.assignedDeliveryBoys || []).forEach(boy => {
                        totalDeliveryBoys.add(boy);
                    });
                });

                document.getElementById('totalAreasSummary').textContent = totalAreas.toString();
                document.getElementById('totalSubAreasSummary').textContent = totalSubAreas.toString();
                document.getElementById('totalDeliveryBoysSummary').textContent = totalDeliveryBoys.size.toString();
            },

            editArea(areaId) {
                const area = this.getAreaById(areaId);
                if (!area) {
                    Toast.error('Area not found', 'Error');
                    return;
                }

                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-dialog" style="max-width: 600px;">
                        <div class="modal-header">
                            <h2>‚úèÔ∏è Edit Area</h2>
                            <button onclick="this.closest('.modal-overlay').remove()" style="background: none; border: none; font-size: 20px; cursor: pointer;">‚úï</button>
                        </div>
                        <div class="modal-body" style="padding: 20px;">
                            <h3 style="margin-bottom: 12px;">Main Area: ${area.name}</h3>
                            
                            <div style="background: var(--light); padding: 12px; border-radius: 6px; margin-bottom: 16px;">
                                <h4 style="margin-bottom: 8px; font-size: 13px;">Sub-Areas (${area.subAreas.length})</h4>
                                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                    ${area.subAreas.map(subArea => `
                                        <span style="background: #667eea; color: white; padding: 6px 12px; border-radius: 20px; font-size: 12px; display: flex; align-items: center; gap: 6px;">
                                            ${subArea}
                                            <button onclick="areaManagementUI.removeSubArea('${areaId}', '${subArea}')" style="background: none; border: none; color: white; cursor: pointer; font-weight: bold;">‚úï</button>
                                        </span>
                                    `).join('')}
                                </div>
                            </div>

                            <div class="form-group" style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 6px; font-weight: 600;">Add New Sub-Area</label>
                                <div style="display: flex; gap: 8px;">
                                    <input type="text" id="newSubAreaName" placeholder="Enter sub-area name" style="flex: 1; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px;">
                                    <button type="button" onclick="areaManagementUI.addSubArea('${areaId}')" style="padding: 10px 16px; background: #2196F3; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 12px;">‚ûï Add</button>
                                </div>
                            </div>

                            <button type="button" class="btn btn-primary" style="width: 100%; padding: 12px;" onclick="this.closest('.modal-overlay').remove();">Done</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            addSubArea(areaId) {
                const area = this.getAreaById(areaId);
                const newSubAreaName = document.getElementById('newSubAreaName').value.trim();

                if (!newSubAreaName) {
                    Toast.error('Please enter sub-area name', 'Required');
                    return;
                }

                if (area.subAreas.includes(newSubAreaName)) {
                    Toast.warning(`"${newSubAreaName}" already exists`, 'Duplicate');
                    return;
                }

                area.subAreas.push(newSubAreaName);
                localStorage.setItem('earlybird_areas', JSON.stringify(this.areas));
                document.getElementById('newSubAreaName').value = '';
                Toast.success(`Added "${newSubAreaName}"`, 'Sub-Area Added');
                
                // Refresh the edit modal
                document.querySelector('.modal-overlay').remove();
                this.editArea(areaId);
            },

            removeSubArea(areaId, subAreaName) {
                const area = this.getAreaById(areaId);
                area.subAreas = area.subAreas.filter(s => s !== subAreaName);
                localStorage.setItem('earlybird_areas', JSON.stringify(this.areas));
                Toast.success(`Removed "${subAreaName}"`, 'Sub-Area Removed');
                
                // Refresh the edit modal
                document.querySelector('.modal-overlay').remove();
                this.editArea(areaId);
            },

            deleteArea(areaId) {
                const area = this.getAreaById(areaId);
                if (!area) return;

                if (confirm(`Delete area "${area.name}" and all its sub-areas?`)) {
                    this.areas = this.areas.filter(a => a.id !== areaId);
                    localStorage.setItem('earlybird_areas', JSON.stringify(this.areas));
                    Toast.success(`Area deleted`, 'Deleted');
                    this.loadAreas();
                }
            }
        };

        // Delivery Management UI
        const deliveryManagementUI = {
            allDeliveries: [],
            filteredDeliveries: [],

            loadDeliveries() {
                const selectedMonth = document.getElementById('deliveryMonth').value || new Date().toISOString().slice(0, 7);
                
                // Get all deliveries from EarlyBirdDelivery
                const allDeliveries = EarlyBirdDelivery?.state?.deliveries || [];
                
                // Filter by selected month
                this.allDeliveries = allDeliveries.filter(delivery => {
                    const deliveryDate = new Date(delivery.createdAt || delivery.date);
                    const deliveryMonth = deliveryDate.toISOString().slice(0, 7);
                    return deliveryMonth === selectedMonth;
                });

                // Load filter options
                this.loadFilterOptions();
                
                // Apply filters and render
                this.applyFilters();
            },

            loadFilterOptions() {
                const areas = [...new Set(this.allDeliveries.map(d => d.area).filter(Boolean))];
                const deliveryBoys = [...new Set(this.allDeliveries.map(d => d.deliveryBoyName).filter(Boolean))];
                const marketingBoys = [...new Set(this.allDeliveries.map(d => d.marketingBoyName).filter(Boolean))];

                // Populate Area filter
                const areaSelect = document.getElementById('deliveryAreaFilter');
                areaSelect.innerHTML = '<option value="">All Areas</option>' + 
                    areas.map(a => `<option value="${a}">${a}</option>`).join('');

                // Populate Delivery Boy filter
                const dbSelect = document.getElementById('deliveryBoyFilter');
                dbSelect.innerHTML = '<option value="">All Delivery Boys</option>' + 
                    deliveryBoys.map(d => `<option value="${d}">${d}</option>`).join('');

                // Populate Marketing Boy filter
                const mbSelect = document.getElementById('marketingBoyFilter');
                mbSelect.innerHTML = '<option value="">All Marketing Boys</option>' + 
                    marketingBoys.map(m => `<option value="${m}">${m}</option>`).join('');
            },

            applyFilters() {
                const customerName = document.getElementById('customerNameSearch')?.value?.toLowerCase() || '';
                const mobile = document.getElementById('mobileSearch')?.value?.toLowerCase() || '';
                const area = document.getElementById('deliveryAreaFilter')?.value || '';
                const deliveryBoy = document.getElementById('deliveryBoyFilter')?.value || '';
                const subscriptionType = document.getElementById('subscriptionTypeFilter')?.value || '';
                const marketingBoy = document.getElementById('marketingBoyFilter')?.value || '';
                const paymentStatus = document.getElementById('paymentStatusFilter')?.value || '';
                const deliveryStatus = document.getElementById('deliveryStatusFilter')?.value || '';

                this.filteredDeliveries = this.allDeliveries.filter(delivery => {
                    const matchCustomer = !customerName || delivery.customerName?.toLowerCase().includes(customerName);
                    const matchMobile = !mobile || delivery.customerPhone?.toLowerCase().includes(mobile);
                    const matchArea = !area || delivery.area === area;
                    const matchDeliveryBoy = !deliveryBoy || delivery.deliveryBoyName === deliveryBoy;
                    const matchSubscription = !subscriptionType || delivery.subscriptionType === subscriptionType;
                    const matchMarketing = !marketingBoy || delivery.marketingBoyName === marketingBoy;
                    const matchPayment = !paymentStatus || delivery.paymentStatus === paymentStatus;
                    const matchDelivery = !deliveryStatus || delivery.status === deliveryStatus;

                    return matchCustomer && matchMobile && matchArea && matchDeliveryBoy && 
                           matchSubscription && matchMarketing && matchPayment && matchDelivery;
                });

                this.renderGrid();
                this.updateSummary();
            },

            clearFilters() {
                document.getElementById('customerNameSearch').value = '';
                document.getElementById('mobileSearch').value = '';
                document.getElementById('deliveryAreaFilter').value = '';
                document.getElementById('deliveryBoyFilter').value = '';
                document.getElementById('subscriptionTypeFilter').value = '';
                document.getElementById('marketingBoyFilter').value = '';
                document.getElementById('paymentStatusFilter').value = '';
                document.getElementById('deliveryStatusFilter').value = '';
                
                this.applyFilters();
            },

            renderGrid() {
                const tbody = document.getElementById('deliveryTableBody');
                
                if (this.filteredDeliveries.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="14" style="padding: 20px; text-align: center; color: var(--text-secondary);">No deliveries found matching filters</td></tr>';
                    return;
                }

                let html = '';
                this.filteredDeliveries.forEach(delivery => {
                    const paymentColor = delivery.paymentStatus === 'paid' ? '#4CAF50' : 
                                        delivery.paymentStatus === 'partial' ? '#2196F3' : '#FF9800';
                    const deliveryColor = delivery.status === 'delivered' ? '#4CAF50' :
                                         delivery.status === 'assigned' ? '#2196F3' :
                                         delivery.status === 'failed' ? '#F44336' : '#FF9800';

                    html += `
                        <tr style="border-bottom: 1px solid var(--border); hover: background: var(--light);">
                            <td style="padding: 12px; color: #667eea; font-weight: 600;">${delivery.id}</td>
                            <td style="padding: 12px;">${delivery.customerName || '-'}</td>
                            <td style="padding: 12px;">${delivery.customerPhone || '-'}</td>
                            <td style="padding: 12px;">${delivery.area || '-'}</td>
                            <td style="padding: 12px;">${delivery.currentItems?.map(i => i.productName).join(', ') || '-'}</td>
                            <td style="padding: 12px;">${delivery.currentItems?.reduce((sum, i) => sum + (i.quantity || 0), 0) || '-'}</td>
                            <td style="padding: 12px;">${delivery.subscriptionType || '-'}</td>
                            <td style="padding: 12px; font-weight: 600;">‚Çπ${delivery.currentTotal || 0}</td>
                            <td style="padding: 12px;">
                                <span style="background: ${paymentColor}20; color: ${paymentColor}; padding: 4px 8px; border-radius: 4px; font-weight: 600; font-size: 11px;">
                                    ${delivery.paymentStatus || 'pending'}
                                </span>
                            </td>
                            <td style="padding: 12px;">
                                <span style="background: ${deliveryColor}20; color: ${deliveryColor}; padding: 4px 8px; border-radius: 4px; font-weight: 600; font-size: 11px;">
                                    ${delivery.status || 'pending'}
                                </span>
                            </td>
                            <td style="padding: 12px;">${delivery.deliveryBoyName || '-'}</td>
                            <td style="padding: 12px;">${delivery.marketingBoyName || '-'}</td>
                            <td style="padding: 12px;">${new Date(delivery.createdAt).toLocaleDateString() || '-'}</td>
                            <td style="padding: 12px; text-align: center;">
                                <button onclick="deliveryManagementUI.editDelivery('${delivery.id}')" 
                                    style="padding: 4px 8px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600; margin-right: 4px;">
                                    ‚úèÔ∏è Edit
                                </button>
                                <button onclick="deliveryManagementUI.generateBill('${delivery.id}')" 
                                    style="padding: 4px 8px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600;">
                                    üìÑ Bill
                                </button>
                            </td>
                        </tr>
                    `;
                });

                tbody.innerHTML = html;
            },

            updateSummary() {
                const totalOrders = this.filteredDeliveries.length;
                const totalAmount = this.filteredDeliveries.reduce((sum, d) => sum + (d.currentTotal || 0), 0);
                const pendingPayment = this.filteredDeliveries
                    .filter(d => d.paymentStatus !== 'paid')
                    .reduce((sum, d) => sum + (d.currentTotal || 0), 0);
                const deliveredCount = this.filteredDeliveries.filter(d => d.status === 'delivered').length;

                document.getElementById('totalOrdersSummary').textContent = totalOrders;
                document.getElementById('totalAmountSummary').textContent = `‚Çπ${totalAmount.toFixed(0)}`;
                document.getElementById('pendingPaymentSummary').textContent = `‚Çπ${pendingPayment.toFixed(0)}`;
                document.getElementById('deliveredCountSummary').textContent = deliveredCount;
            },

            editDelivery(deliveryId) {
                const delivery = this.allDeliveries.find(d => d.id === deliveryId);
                if (!delivery) return;

                const modal = document.createElement('div');
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal-dialog" style="max-width: 600px;">
                        <div class="modal-header">
                            <h2>‚úèÔ∏è Edit Delivery</h2>
                            <button onclick="this.closest('.modal-overlay').remove()" style="background: none; border: none; font-size: 20px; cursor: pointer;">‚úï</button>
                        </div>
                        <div class="modal-body" style="padding: 20px;">
                            <div style="display: grid; gap: 16px;">
                                <div>
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px;">Delivery Boy *</label>
                                    <select id="editDeliveryBoy" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
                                        <option value="">-- Select Delivery Boy --</option>
                                        <option value="Raj Kumar" ${delivery.deliveryBoyName === 'Raj Kumar' ? 'selected' : ''}>Raj Kumar</option>
                                        <option value="Rohan" ${delivery.deliveryBoyName === 'Rohan' ? 'selected' : ''}>Rohan</option>
                                        <option value="Unassigned" ${delivery.deliveryBoyName === 'Unassigned' ? 'selected' : ''}>Unassigned</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px;">Marketing Boy *</label>
                                    <select id="editMarketingBoy" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
                                        <option value="">-- Select Marketing Boy --</option>
                                        <option value="Priya" ${delivery.marketingBoyName === 'Priya' ? 'selected' : ''}>Priya</option>
                                        <option value="Vikas" ${delivery.marketingBoyName === 'Vikas' ? 'selected' : ''}>Vikas</option>
                                        <option value="Sarah" ${delivery.marketingBoyName === 'Sarah' ? 'selected' : ''}>Sarah</option>
                                        <option value="Amit" ${delivery.marketingBoyName === 'Amit' ? 'selected' : ''}>Amit</option>
                                        <option value="Neha" ${delivery.marketingBoyName === 'Neha' ? 'selected' : ''}>Neha</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px;">Payment Status *</label>
                                    <select id="editPaymentStatus" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
                                        <option value="pending" ${delivery.paymentStatus === 'pending' ? 'selected' : ''}>Pending</option>
                                        <option value="partial" ${delivery.paymentStatus === 'partial' ? 'selected' : ''}>Partial</option>
                                        <option value="paid" ${delivery.paymentStatus === 'paid' ? 'selected' : ''}>Paid</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600; font-size: 13px;">Delivery Status *</label>
                                    <select id="editDeliveryStatus" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px;">
                                        <option value="pending" ${delivery.status === 'pending' ? 'selected' : ''}>Pending</option>
                                        <option value="assigned" ${delivery.status === 'assigned' ? 'selected' : ''}>Assigned</option>
                                        <option value="delivered" ${delivery.status === 'delivered' ? 'selected' : ''}>Delivered</option>
                                        <option value="failed" ${delivery.status === 'failed' ? 'selected' : ''}>Failed</option>
                                    </select>
                                </div>
                                <div style="display: flex; gap: 8px; margin-top: 16px;">
                                    <button onclick="deliveryManagementUI.saveEdit('${deliveryId}')" 
                                        class="btn btn-primary" style="flex: 1;">‚úì Save Changes</button>
                                    <button onclick="this.closest('.modal-overlay').remove()" 
                                        class="btn btn-outline" style="flex: 1;">Cancel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            },

            saveEdit(deliveryId) {
                const delivery = this.allDeliveries.find(d => d.id === deliveryId);
                if (!delivery) return;

                delivery.deliveryBoyName = document.getElementById('editDeliveryBoy').value;
                delivery.marketingBoyName = document.getElementById('editMarketingBoy').value;
                delivery.paymentStatus = document.getElementById('editPaymentStatus').value;
                delivery.status = document.getElementById('editDeliveryStatus').value;

                // Save to localStorage
                localStorage.setItem('earlybird_deliveries', JSON.stringify(EarlyBirdDelivery.state.deliveries || []));

                // Close modal and refresh
                document.querySelector('.modal-overlay').remove();
                this.applyFilters();
                Toast.success('Delivery updated successfully!', 'Delivery Updated');
            },

            generateBill(deliveryId) {
                const delivery = this.allDeliveries.find(d => d.id === deliveryId);
                if (!delivery) return;

                const billText = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    ORDER INVOICE - BILL                    ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üì¶ ORDER DETAILS
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Order ID:             ${delivery.id}
Order Date:           ${new Date(delivery.createdAt).toLocaleDateString('en-IN')}
Delivery Date:        ${delivery.deliveryDate || 'Not set'}

üë§ CUSTOMER INFORMATION
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Customer Name:        ${delivery.customerName || '-'}
Mobile Number:        ${delivery.customerPhone || '-'}
Area:                 ${delivery.area || '-'}
Address:              ${delivery.address || '-'}

üìã ORDER ITEMS
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
${(delivery.currentItems || []).map((item, idx) => 
    `Item ${idx + 1}: ${item.productName || 'Product'}\n  Quantity: ${item.quantity} √ó ‚Çπ${item.price} = ‚Çπ${item.quantity * item.price}`
).join('\n')}

üí≥ BILLING SUMMARY
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Subtotal:             ‚Çπ${delivery.currentTotal || 0}
Tax (GST):            ‚Çπ0
Total Amount:         ‚Çπ${delivery.currentTotal || 0}

üìä PAYMENT INFORMATION
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Payment Status:       ${delivery.paymentStatus || 'Pending'}
Subscription Type:    ${delivery.subscriptionType || 'One-time'}

üöö DELIVERY INFORMATION
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Delivery Boy:         ${delivery.deliveryBoyName || 'Not assigned'}
Marketing Boy:        ${delivery.marketingBoyName || 'Not assigned'}
Delivery Status:      ${delivery.status || 'Pending'}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Generated on: ${new Date().toLocaleString('en-IN')}
Thank you for your order!
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                `;

                // Copy to clipboard
                navigator.clipboard.writeText(billText).then(() => {
                    Toast.success('Bill copied to clipboard!', 'Copied');
                }).catch(err => {
                    Toast.info('Bill generated - view in console', 'Bill');
                });
            },

            exportToExcel() {
                let csvContent = 'data:text/csv;charset=utf-8,';
                csvContent += 'Order ID,Customer,Mobile,Area,Product,Qty,Subscription,Total,Payment Status,Delivery Status,Delivery Boy,Marketing Boy,Date\n';
                
                this.filteredDeliveries.forEach(delivery => {
                    const row = [
                        delivery.id,
                        delivery.customerName || '-',
                        delivery.customerPhone || '-',
                        delivery.area || '-',
                        (delivery.currentItems || []).map(i => i.productName).join('; ') || '-',
                        (delivery.currentItems || []).reduce((sum, i) => sum + (i.quantity || 0), 0),
                        delivery.subscriptionType || '-',
                        delivery.currentTotal || 0,
                        delivery.paymentStatus || 'pending',
                        delivery.status || 'pending',
                        delivery.deliveryBoyName || '-',
                        delivery.marketingBoyName || '-',
                        new Date(delivery.createdAt).toLocaleDateString('en-IN')
                    ];
                    csvContent += row.map(cell => `"${cell}"`).join(',') + '\n';
                });

                const encodedUri = encodeURI(csvContent);
                const link = document.createElement('a');
                link.setAttribute('href', encodedUri);
                link.setAttribute('download', `deliveries_${new Date().toISOString().slice(0,7)}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        };

        // Initialize calendar on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Check authentication
            if (!EarlyBirdAuth.isAuthenticated()) {
                window.location.href = 'login.html';
                return;
            }

            const currentUser = EarlyBirdAuth.getCurrentUser();
            if (currentUser.role !== 'admin' && currentUser.role !== 'marketing_staff') {
                Toast.warning('Access denied. Admin/Marketing only.', 'Access Denied');
                window.location.href = EarlyBirdAuth.getRedirectUrl(currentUser.role);
                return;
            }

            // Display user info in header
            const userInfoEl = document.querySelector('.user-info .user-name');
            if (userInfoEl) {
                userInfoEl.textContent = currentUser.name;
            }

            // Initialize data from localStorage
            if (localStorage.getItem('earlybird_customers')) {
                if (!window.EarlyBirdOrders) window.EarlyBirdOrders = { state: {} };
                window.EarlyBirdOrders.state.customers = JSON.parse(localStorage.getItem('earlybird_customers'));
            }
            if (localStorage.getItem('earlybird_orders')) {
                if (!window.EarlyBirdOrders) window.EarlyBirdOrders = { state: {} };
                window.EarlyBirdOrders.state.orders = JSON.parse(localStorage.getItem('earlybird_orders'));
            }

            // Initialize calendar asynchronously
            setTimeout(() => {
                try {
                    initCalendar();
                } catch (e) {
                    console.warn('Calendar init:', e);
                }
            }, 50);
        });
    </script>

    <!-- Initialize Subscription System After DOM Load -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof initializeSubscriptionSystem === 'function') {
                initializeSubscriptionSystem();
            }
        });
    </script>
</body>
</html>
            
            // Remove active state from all tabs
            document.getElementById('tab-subscriptions').classList.remove('active');
            document.getElementById('tab-orders').classList.remove('active');
            document.getElementById('tab-subscriptions').style.borderBottomColor = 'transparent';
            document.getElementById('tab-orders').style.borderBottomColor = 'transparent';
            
            // Show selected tab
            if (tabName === 'subscriptions') {
                document.getElementById('subscriptionsTabContent').style.display = 'block';
                document.getElementById('tab-subscriptions').classList.add('active');
                document.getElementById('tab-subscriptions').style.borderBottomColor = 'var(--primary)';
                document.getElementById('tab-subscriptions').style.color = 'var(--primary)';
                adminPortalUI.loadSubscriptions();
            } else if (tabName === 'orders') {
                document.getElementById('ordersTabContent').style.display = 'block';
                document.getElementById('tab-orders').classList.add('active');
                document.getElementById('tab-orders').style.borderBottomColor = 'var(--primary)';
                document.getElementById('tab-orders').style.color = 'var(--primary)';
                adminPortalUI.loadOrders();
            }
        }
    </script>

    <!-- Initialize Subscription System After DOM Load -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof initializeSubscriptionSystem === 'function') {
                initializeSubscriptionSystem();
            }
        });
    </script>
</body>
</html>
